<app-modal-primeng
    [title]="'RECUPERAR CONTRASEÑA'"
    [showModal]="showModal"
    [width]="'560px'"
    (accionBtnItem)="accionBtn($event)"
>
    @switch (formulario) {
        @case (1) {
            <form
                class="flex justify-content-center align-items-center pt-6 px-6"
                [formGroup]="formCredencial"
            >
                <div class="grid">
                    <div class="col-12 text-center">
                        <h2 class="font-bold">¿Has olvidado tu contraseña?</h2>
                    </div>
                    <div class="col-12 text-justify">
                        ¡No te preocupes!, ingresa tu usuario y dirección de
                        correo electrónico a continuación y te enviaremos un
                        código de verificación para restablecer tu contraseña.
                    </div>

                    <div class="col-12">
                        <div class="flex justify-content-start grid">
                            <div class="flex flex-column mt-4 w-full">
                                <label class="font-bold" for="usuario"
                                    >Usuario</label
                                >
                                <input
                                    class="mt-1"
                                    type="text"
                                    pInputText
                                    placeholder="Ingrese su usuario"
                                    name="usuario"
                                    formControlName="cUsuario"
                                />
                            </div>
                            <div class="flex flex-column mt-4 w-full">
                                <label class="font-bold" for="correo"
                                    >Correo</label
                                >
                                <input
                                    class="mt-1"
                                    type="text"
                                    pInputText
                                    placeholder="Ingrese su correo electrónico"
                                    name="correo"
                                    formControlName="cCorreo"
                                />
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        }
        @case (2) {
            <form
                class="flex justify-content-center align-items-center pt-6 px-6"
                [formGroup]="formCredencial"
            >
                <div class="grid">
                    <div class="col-12 text-center">
                        <h2 class="font-bold">¿Has olvidado tu contraseña?</h2>
                    </div>
                    <div class="col-12 text-justify">
                        Hemos enviado un correo electrónico con el código de
                        verificación para restablecer la contraseña.
                    </div>
                    <div class="col-12 text-center">
                        <span class="font-bold">{{
                            formCredencial.value.cCorreo
                        }}</span>
                    </div>
                    <p-inputOtp
                        formControlName="cCredTokenPassword"
                        class="col-12 mt-2"
                        style="gap: 2"
                        [length]="6"
                        ><ng-template
                            pTemplate="input"
                            let-token
                            let-events="events"
                        >
                            <input
                                type="text"
                                class="w-full p-inputtext-sm ml-1 codigo"
                                maxlength="1"
                                pInputText
                                (input)="events.input($event)"
                                (keydown)="events.keydown($event)"
                            /> </ng-template
                    ></p-inputOtp>
                </div>
            </form>
        }
        @case (3) {
            <form
                class="flex justify-content-center align-items-center pt-6 px-6"
                [formGroup]="formCredencial"
            >
                <div class="grid">
                    <div class="col-12 text-center">
                        <h2 class="font-bold">Ingrese una nueva contraseña</h2>
                    </div>
                    <div class="col-12 text-justify">
                        Ingrese su nueva contraseña a continuación para
                        completar el proceso de restablecimiento
                    </div>

                    <div class="col-12">
                        <div class="flex justify-content-start grid">
                            <div class="flex flex-column mt-4 w-full">
                                <label class="font-bold" for="usuario"
                                    >Nueva Contraseña</label
                                >
                                <div class="flex mt-1">
                                    <input
                                        pInputText
                                        [type]="
                                            !showPassword ? 'password' : 'text'
                                        "
                                        class="flex-1 border-noround-right"
                                        [placeholder]="
                                            !showPassword ? '********' : ''
                                        "
                                        formControlName="cPassword"
                                    />
                                    <button
                                        class="p-button-outlined p-button-secondary border-noround-left"
                                        type="button"
                                        pButton
                                        (click)="showPassword = !showPassword"
                                    >
                                        @if (showPassword) {
                                            <i class="pi pi-eye"></i>
                                        } @else {
                                            <i class="pi pi-eye-slash"></i>
                                        }
                                    </button>
                                </div>
                                <!-- <input class="mt-1" type="password" pInputText placeholder="***********************"
                            formControlName="cPassword" /> -->
                            </div>
                            <div class="flex flex-column mt-4 w-full">
                                <label class="font-bold" for="correo"
                                    >Repite nueva contraseña</label
                                >
                                <div class="flex mt-1">
                                    <input
                                        pInputText
                                        [type]="
                                            !showPasswordConfir
                                                ? 'password'
                                                : 'text'
                                        "
                                        class="flex-1 border-noround-right"
                                        [placeholder]="
                                            !showPasswordConfir
                                                ? '********'
                                                : ''
                                        "
                                        formControlName="cPasswordConfir"
                                    />
                                    <button
                                        class="p-button-outlined p-button-secondary border-noround-left"
                                        type="button"
                                        pButton
                                        (click)="
                                            showPasswordConfir =
                                                !showPasswordConfir
                                        "
                                    >
                                        @if (showPasswordConfir) {
                                            <i class="pi pi-eye"></i>
                                        } @else {
                                            <i class="pi pi-eye-slash"></i>
                                        }
                                    </button>
                                </div>
                                <!-- <input class="mt-1" type="password" pInputText placeholder="***********************"
                            formControlName="cPasswordConfir" /> -->
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        }
        @case (4) {
            <form
                class="flex justify-content-center align-items-center pt-6 px-6"
            >
                <div class="grid">
                    <div class="col-12 text-center">
                        <img
                            src="assets/images/icons/good2.gif"
                            alt="logo"
                            width="50%"
                        />
                    </div>
                    <div class="col-12 text-center">
                        <h2 class="font-bold">
                            Su contraseña ha sido restablecida exitosamente
                        </h2>
                    </div>
                    <div class="col-12 text-justify">
                        Ahora puedes iniciar sesión con tu nueva contraseña. Si
                        tiene algún problema, comuníquese con el soporte.
                    </div>
                </div>
            </form>
        }
    }
    <div footer class="px-6">
        <div class="mb-3">
            @if (formulario === 1) {
                <p-button
                    label="Enviar"
                    class="w-full"
                    styleClass="w-full"
                    [loading]="loadingUsuario"
                    (onClick)="obtenerUsuario()"
                    [disabled]="this.formCredencial.invalid"
                />
            }
            @if (formulario === 2) {
                <p-button
                    label="Verificar"
                    class="w-full"
                    styleClass="w-full"
                    [loading]="loadingVerificarUsuario"
                    (onClick)="verificarUsuario()"
                    [disabled]="
                        this.formCredencial.value.cCredTokenPassword === ''
                    "
                />
            }

            @if (formulario === 3) {
                <p-button
                    label="Continuar"
                    class="w-full"
                    styleClass="w-full"
                    [loading]="loadingActualizarUsuario"
                    (onClick)="actualizarUsuario()"
                    [disabled]="
                        this.formCredencial.value.cPassword !==
                            this.formCredencial.value.cPasswordConfir &&
                        this.formCredencial.value.cPassword === ''
                    "
                />
            }
            @if (formulario === 4) {
                <p-button
                    label="Regresar a inicio de sesion"
                    class="w-full"
                    styleClass="w-full"
                    (onClick)="showModal = false"
                />
            }
        </div>
        @if (formulario < 3) {
            <div class="mb-3">
                <p-button
                    label="Cancelar"
                    class="w-full"
                    styleClass="w-full"
                    (onClick)="showModal = false"
                    severity="secondary"
                />
            </div>
        }
    </div>
</app-modal-primeng>

<p-toast />
