<app-toolbar-primeng
    [title]="
        'Evaluación Formativa: ' +
        (evaluacion?.cEvaluacionTitulo || 'Título no disponible')
    "
></app-toolbar-primeng>

<div class="grid">
    <!-- <div class="flex flex-column mb-4">
        <article class="card" style="position: sticky; top: 0; z-index: 10; background: white; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);">
          <h2>Calificación: {{ evaluacion?.cEvaluacionTitulo }}</h2>
        </article>
      </div> -->

    <div
        class="flex flex-column gap-4 md:flex-row md:align-items-start align-items-stretch"
    >
        <!-- Panel Izquierdo -->
        <div
            class="flex flex-column gap-2 card"
            style="overflow-y: auto; max-height: 500px"
        >
            <div class="flex gap-4 align-items-center flex-wrap mx-auto">
                <div class="grid">
                    <div class="col-6 leyenda-tareas">
                        <div class="flex align-items-center">
                            <div
                                class="w-1rem h-1rem border-circle"
                                [ngClass]="'bg-red-500'"
                            ></div>
                            <div>
                                <b style="font-size: 1.5rem"> &nbsp;0 </b>
                                <small>&nbsp;Falta</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-6 leyenda-tareas">
                        <div class="flex align-items-center">
                            <div
                                class="w-1rem h-1rem border-circle"
                                [ngClass]="'bg-green-500'"
                            ></div>
                            <div>
                                <b style="font-size: 1.5rem">&nbsp;0</b>
                                <small>&nbsp;Culminado</small>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="topbar__bars_modulo">
                    <button #menubutton class="p-link" (click)="toggleMenu()">
                        <i class="pi pi-bars"></i>
                    </button>
                </div>
                <div class="menu-content" *ngIf="menuVisible">
                    <!-- Aquí va el contenido que se mostrará u ocultará -->
                    <p>Contenido del menú</p>
                </div>

                <!-- <ng-container
                    *ngFor="let leyenda of leyendasOrden; let i = index"
                >
                    <app-leyenda
                        [total]="leyendas()[leyenda].total"
                        [text]="leyendas()[leyenda].text"
                        [size]="$any(leyendas()[leyenda].size)"
                        [colorClass]="leyendas()[leyenda].colorClass"
                    ></app-leyenda>
                </ng-container> -->
            </div>
            <!-- <div class="w-full">
                <p-iconField iconPosition="left" class="w-full">
                    <p-inputIcon styleClass="pi pi-search"></p-inputIcon>
                    <input
                        type="text"
                        pInputText
                        placeholder="Buscar"
                        class="w-full"
                    />
                </p-iconField>
            </div> -->
            <div
                class="flex justify-content-between gap-2 flex-column sm:flex-row flex-wrap"
            >
                <p-iconField iconPosition="left">
                    <p-inputIcon styleClass="pi pi-search text-md" />
                    <input
                        pInputText
                        type="text"
                        class="py-2"
                        (input)="onGlobalFilter(dv, $event)"
                        placeholder="Buscar por apellidos y nombres"
                    />
                </p-iconField>
            </div>
            <p-table
                [value]="evaluacionesEstudiantes()"
                selectionMode="single"
                [selection]="selectedEstudianteValue"
                (selectionChange)="updateSelectedEstudiante($event)"
                dataKey="iEstudianteId"
                (onRowSelect)="seleccionarEvaluacion()"
                [scrollable]="true"
                scrollHeight="250px"
            >
                <ng-template pTemplate="header">
                    <tr>
                        <th>Nombre y Apellidos</th>
                        <th>Estado</th>
                        <!-- <th>Puntaje Final</th> -->
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-estudiante>
                    <tr [pSelectableRow]="estudiante">
                        <td>
                            {{ estudiante.cEstNombres }} <br />
                            {{ estudiante.cEstPaterno }}
                            {{ estudiante.cEstMaterno }}
                        </td>
                        <td>
                            <span
                                class="block w-1rem h-1rem border-circle"
                                [ngClass]="{
                                    'bg-red-500':
                                        estudiante.cEstado === 'FALTA',
                                    'bg-yellow-500':
                                        estudiante.cEstado === 'PROCESO',
                                    'bg-green-500':
                                        estudiante.cEstado === 'REVISADO',
                                }"
                            ></span>
                        </td>
                        <!-- <td>{{ estudiante.cNotaFinal }}</td> -->
                    </tr>
                </ng-template>
            </p-table>
        </div>

        <!-- Panel Derecho -->
        <div class="flex flex-column flex-1 gap-4">
            <ng-container *ngIf="!!selectedEstudiante(); else emptySection">
                <app-evaluacion-info
                    [evaluacionEstudiante]="selectedEstudiante()"
                ></app-evaluacion-info>
                <div class="grid">
                    <div class="col-12">
                        <p-inputGroup>
                            <p-inputGroupAddon>
                                Retroalimentación
                            </p-inputGroupAddon>
                            <textarea pInputText></textarea>
                        </p-inputGroup>
                    </div>

                    <div class="col-12 text-right text-center">
                        <p-toast></p-toast>
                        <p-button
                            severity="success"
                            label="Guardar"
                            icon="pi pi-plus"
                            iconPos="left"
                            (onClick)="guardarEvaluacionEstudiantesxDocente()"
                        />
                    </div>
                </div>
                <div>
                    <h3 class="text-primary">Preguntas</h3>
                    <hr />
                </div>
                <div class="flex flex-column gap-4 preguntas-container">
                    <p-accordion [multiple]="true">
                        <ng-container
                            *ngFor="
                                let pregunta of selectedEstudiante().preguntas;
                                let i = index
                            "
                        >
                            <p-accordionTab [selected]="true">
                                <ng-template pTemplate="header">
                                    <div class="ellipsis">
                                        <span>{{
                                            pregunta['cPregunta'] | removeHTML
                                        }}</span>
                                    </div>
                                </ng-template>
                                <app-evaluacion-pregunta
                                    (calificarPreguntaChange)="
                                        calificarPregunta($event)
                                    "
                                    [pregunta]="pregunta"
                                ></app-evaluacion-pregunta>
                            </p-accordionTab>
                        </ng-container>
                    </p-accordion>
                </div>
            </ng-container>
            <ng-template #emptySection>
                <div align="center" class="mt-4">
                    <app-empty-section
                        class="w-full"
                        [message]="'Ningún Estudiante seleccionado'"
                    ></app-empty-section>
                </div>
            </ng-template>
        </div>
    </div>
</div>
