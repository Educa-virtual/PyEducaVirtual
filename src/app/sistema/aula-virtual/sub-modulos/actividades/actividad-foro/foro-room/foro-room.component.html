<section class="flex flex-column gap-4">
    <p-tabView styleClass="actividad-tabs">
        <!-- Mostrar informacion general del foro -->
        <p-tabPanel>
            <ng-template pTemplate="header" class="header">
                <div class="flex align-items-center flex-column gap-2">
                    <app-icon name="matListAlt"></app-icon>
                    <span class="font-bold white-space-nowrap m-0">
                        Instrucciones
                    </span>
                </div>
            </ng-template>
            <div class="flex flex-column gap-4">
                <div class="card grid">
                    <div
                        [class]="
                            iPerfilId === ESTUDIANTE
                                ? 'col-12 md:col-8'
                                : 'col-12'
                        "
                    >
                        <article class="card">
                            <div class="TituloForo">
                                {{ foro?.cForoTitulo }}
                            </div>
                            <hr />

                            <div class="grid mb-4">
                                <div
                                    class="col-12 md:col-6 flex flex-column gap-2 align-items-start"
                                >
                                    <div
                                        class="col-12 md:col-6 gap-2 flex flex-column"
                                    >
                                        <span class="font-bold text-xl"
                                            >Catergoria:</span
                                        >
                                        {{ foro?.cForoCatDescripcion }}
                                    </div>
                                </div>
                            </div>

                            <div class="grid mb-4">
                                <div
                                    class="col-12 md:col-6 flex flex-column gap-2"
                                >
                                    <span class="font-bold text-xl flex gap-2">
                                        <app-icon
                                            name="matCalendarMonth"
                                            class="text-primary"
                                            size="sm"
                                        ></app-icon>
                                        Inicio de Foro:
                                    </span>
                                    <!-- {{ foro.dtForoInicio }} -->
                                    <p class="flex gap-2 flex-wrap">
                                        {{
                                            foro?.dtForoInicio
                                                | date
                                                    : "EEEE, d 'de' MMMM 'de' yyyy"
                                        }}

                                        <span class="flex gap-2">
                                            <app-icon
                                                name="matAccessTime"
                                                class="text-primary"
                                                size="sm"
                                            ></app-icon>
                                            <span class="font-bold"
                                                >Hora Limite:</span
                                            >
                                            {{
                                                foro?.dtForoInicio
                                                    | date: 'h:mm a'
                                            }}
                                        </span>
                                    </p>
                                </div>
                                <div
                                    class="col-12 md:col-6 flex flex-column gap-2"
                                >
                                    <span class="font-bold text-xl flex gap-2">
                                        <app-icon
                                            name="matCalendarMonth"
                                            class="text-primary"
                                            size="sm"
                                        ></app-icon>
                                        Cierre de Foro
                                    </span>
                                    <!-- {{ foro.dtForoFin }} -->
                                    <p class="flex gap-2 flex-wrap">
                                        {{
                                            foro?.dtForoFin
                                                | date
                                                    : "EEEE, d 'de' MMMM 'de' yyyy"
                                        }}

                                        <span class="flex gap-2">
                                            <app-icon
                                                name="matAccessTime"
                                                class="text-primary"
                                                size="sm"
                                            ></app-icon>
                                            <span class="font-bold"
                                                >Hora Limite:</span
                                            >
                                            {{
                                                foro?.dtForoFin | date: 'h:mm a'
                                            }}
                                        </span>
                                    </p>
                                </div>
                            </div>

                            <div
                                class="flex gap-2 flex-wrap align-items-center mb-4"
                            >
                                <app-icon
                                    name="matMessage"
                                    color="text-primary"
                                    size="sm"
                                />
                                <h3 class="text-lg m-0">Descripción:</h3>
                                {{ foro?.cForoDescripcion | removeHTML }}
                            </div>

                            <div
                                class="bg-gray-100 p-1 border-round min-h-10rem flex gap-2 flex-column"
                            ></div>
                        </article>
                    </div>
                    <div
                        class="col-12 md:col-4"
                        [hidden]="iPerfilId !== ESTUDIANTE"
                    >
                        <div
                            class="card"
                            *ngFor="let respuesta of respuestasForo"
                        >
                            <h4>Mi Retroalimentación descriptiva:</h4>
                            <!-- <p-divider></p-divider> -->
                            <!-- <p-inputGroup>
                                <p-inputGroupAddon> Nota </p-inputGroupAddon>
                                <input pInputText />
                            </p-inputGroup> -->
                            <p-divider></p-divider>
                            <p-inputGroup>
                                <p-inputGroupAddon>
                                    Comentario Docente:
                                </p-inputGroupAddon>
                                <textarea
                                    pInputText
                                    rows="1"
                                    id="comentarioDocente"
                                    pInputTextarea
                                    rows="5"
                                    [disabled]="isDisabled"
                                    class="p-inputtextarea-lg"
                                    placeholder="Muestra Comentario Docente"
                                >
 {{ respuesta?.cForoRptaDocente }} </textarea
                                >
                            </p-inputGroup>
                        </div>
                    </div>
                </div>
                <article class="card">
                    <h2>Recursos:</h2>
                    <app-recursos-lista [files]="FilesTareas">
                    </app-recursos-lista>
                </article>
            </div>
        </p-tabPanel>
        <!-- Ver Comentarios de los Foros -->
        <p-tabPanel>
            <ng-template pTemplate="header">
                <div class="flex align-items-center flex-column gap-2">
                    <app-icon name="matRule"></app-icon>
                    <span class="font-bold white-space-nowrap m-0">
                        Ver Foro
                    </span>
                </div>
            </ng-template>
            <form
                [formGroup]="foroFormComntAl"
                class="flex flex-column gap-3 w-full"
            >
                <div class="flex flex-column gap-4">
                    <div class="card">
                        <div class="TituloForo">
                            {{ foro?.cForoTitulo }}
                        </div>
                        <hr />
                        <!-- <div class="TituloCurso">Nombre de curso:</div> -->
                        <div class="grid">
                            <div class="col-12 md:col-6 flex flex-column gap-2">
                                <p class="flex gap-2 flex-wrap">
                                    <app-icon
                                        name="matCalendarMonth"
                                        class="text-primary"
                                        size="sm"
                                    ></app-icon>
                                    {{
                                        foro?.dtForoInicio
                                            | date
                                                : "EEEE, d 'de' MMMM 'de' yyyy"
                                    }}
                                    <app-icon
                                        name="matAccessTime"
                                        class="text-primary"
                                        size="sm"
                                    ></app-icon>
                                    <span class="font-bold">Hora Limite:</span>
                                    <span class="flex gap-2">
                                        {{
                                            foro?.dtForoInicio | date: 'h:mm a'
                                        }}
                                    </span>
                                </p>
                            </div>
                            <div class="col-12 md:col-6 flex flex-column gap-2">
                                <p class="flex gap-2 flex-wrap">
                                    <app-icon
                                        name="matCalendarMonth"
                                        class="text-primary"
                                        size="sm"
                                    ></app-icon>
                                    {{
                                        foro?.dtForoFin
                                            | date
                                                : "EEEE, d 'de' MMMM 'de' yyyy"
                                    }}

                                    <span class="flex gap-2">
                                        <app-icon
                                            name="matAccessTime"
                                            class="text-primary"
                                            size="sm"
                                        ></app-icon>
                                        <span class="font-bold"
                                            >Hora Limite:</span
                                        >
                                        {{ foro?.dtForoFin | date: 'h:mm a' }}
                                    </span>
                                </p>
                            </div>
                        </div>
                    </div>
                    <p-messages
                        *ngIf="messages"
                        [(value)]="messages"
                        [enableService]="false"
                        [closable]="false"
                        class="custom-message"
                    />

                    <div class="">
                        <div class="card grid">
                            <!-- listar comentarios -->
                            <div
                                [class]="
                                    iPerfilId === DOCENTE
                                        ? 'col-12 md:col-8'
                                        : 'col-12'
                                "
                            >
                                <div class="pb-2">
                                    <label
                                        for=""
                                        class=""
                                        style="
                                            font-weight: bold;
                                            font-size: 16px;
                                        "
                                        >Chats:
                                    </label>
                                </div>
                                <p-orderList
                                    class="list"
                                    [value]="respuestasForo"
                                >
                                    <ng-template
                                        let-respuestas
                                        of
                                        comentarios
                                        pTemplate="listItem"
                                        let-i="index"
                                    >
                                        <!-- Agregar el length -->
                                        @if (1 > 0) {
                                            <p-button
                                                [text]="true"
                                                severity="secondary"
                                                class="btnContorno"
                                            >
                                                <div
                                                    class="perfiles-list-item text-left"
                                                    tabindex="0"
                                                    [class.highlight]="
                                                        estudianteSelectComent &&
                                                        respuestas.iEstudianteId ===
                                                            estudianteSelectComent
                                                    "
                                                >
                                                    <div
                                                        class="perfiles-list-detail"
                                                    >
                                                        <div class="flex">
                                                            <div>
                                                                <img
                                                                    src="assets/demo/images/matemit/user.png"
                                                                    [alt]="
                                                                        respuestas.name
                                                                    "
                                                                    class="w-3rem min-h-9 shadow-2 flex-shrink-0 btn"
                                                                />
                                                            </div>
                                                            <div>
                                                                <div
                                                                    class="pb-2 perfil-name"
                                                                >
                                                                    <span
                                                                        class="user-name"
                                                                    >
                                                                        {{
                                                                            respuestas.cNombres
                                                                        }}
                                                                        {{
                                                                            respuestas?.dtCreado
                                                                                | date
                                                                                    : 'short'
                                                                        }}
                                                                    </span>
                                                                </div>
                                                                <div
                                                                    class=""
                                                                    style="
                                                                        text-align: justify;
                                                                    "
                                                                >
                                                                    <span
                                                                        *ngIf="
                                                                            !respuestas.expanded
                                                                        "
                                                                    >
                                                                        {{
                                                                            respuestas?.cForoRptaRespuesta
                                                                                | removeHTML
                                                                                | slice
                                                                                    : 0
                                                                                    : 150
                                                                        }}...
                                                                    </span>
                                                                    <span
                                                                        *ngIf="
                                                                            respuestas.expanded
                                                                        "
                                                                    >
                                                                        {{
                                                                            respuestas?.cForoRptaRespuesta
                                                                                | removeHTML
                                                                        }}
                                                                    </span>
                                                                    <!-- Para Leer mas.. -->
                                                                    <button
                                                                        (click)="
                                                                            toggleExpand(
                                                                                respuestas
                                                                            )
                                                                        "
                                                                        class="toggle-link"
                                                                    >
                                                                        {{
                                                                            respuestas.expanded
                                                                                ? 'Leer menos'
                                                                                : 'Leer más'
                                                                        }}
                                                                    </button>
                                                                </div>
                                                                <div
                                                                    class="display flex"
                                                                >
                                                                    <!-- startReply(i) -->
                                                                    <div
                                                                        class="actions-container"
                                                                    >
                                                                        <!-- Los Likes -->
                                                                        <button
                                                                            pButton
                                                                            type="button"
                                                                            class="p-button-text"
                                                                        >
                                                                            <i
                                                                                class="pi pi-thumbs-up"
                                                                                style="
                                                                                    font-size: 18px;
                                                                                "
                                                                            ></i>
                                                                        </button>
                                                                        <!-- Contador de Sub mensajes -->
                                                                        <button
                                                                            pButton
                                                                            type="button"
                                                                            class="p-button-text"
                                                                            (click)="
                                                                                startReply(
                                                                                    i
                                                                                )
                                                                            "
                                                                        >
                                                                            <label
                                                                                for=""
                                                                                class="text-sm text-black pr-2"
                                                                                >{{
                                                                                    respuestas
                                                                                        .json_respuestas_comentarios
                                                                                        .length ||
                                                                                        0
                                                                                }}
                                                                                Respuestas
                                                                            </label>
                                                                            <i
                                                                                class="pi pi-comments"
                                                                                style="
                                                                                    font-size: 18px;
                                                                                "
                                                                            ></i>
                                                                        </button>
                                                                    </div>
                                                                    <!-- Menú al final -->
                                                                    <div
                                                                        class=""
                                                                    >
                                                                        <button
                                                                            [style.display]="
                                                                                !respuestas.iEstudianteId
                                                                                    ? respuestas.iDocenteId ===
                                                                                      iDocenteId
                                                                                    : respuestas.iEstudianteId ===
                                                                                      iEstudianteId
                                                                            "
                                                                            pButton
                                                                            type="button"
                                                                            icon="pi pi-ellipsis-v"
                                                                            class="menu-container p-button-text"
                                                                            (click)="
                                                                                itemRespuesta =
                                                                                    respuestas;
                                                                                menu.toggle(
                                                                                    $event
                                                                                )
                                                                            "
                                                                            aria-label="Abrir menú de configuración"
                                                                        ></button>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </p-button>
                                            <div
                                                class="ml-5"
                                                *ngIf="
                                                    selectedCommentIndex === i
                                                "
                                            >
                                                <p-button
                                                    [text]="true"
                                                    severity="secondary"
                                                    class="p-col-12 btCalificacion"
                                                >
                                                    <div
                                                        class="perfiles-list-item text-left"
                                                    >
                                                        <!-- Campo de respuesta y botón enviar -->
                                                        <div>
                                                            @for (
                                                                item of respuestas.json_respuestas_comentarios;
                                                                track item
                                                            ) {
                                                                <div
                                                                    class="flex mt-1 mb-1"
                                                                >
                                                                    <div>
                                                                        <img
                                                                            src="assets/demo/images/matemit/userA.png"
                                                                            [alt]="
                                                                                respuestas.name
                                                                            "
                                                                            class="w-3rem min-h-9 shadow-2 flex-shrink-0 btn"
                                                                        />
                                                                    </div>
                                                                    <div>
                                                                        <div
                                                                            class="pb-2 perfil-name"
                                                                        >
                                                                            {{
                                                                                item.cNombres
                                                                            }}

                                                                            {{
                                                                                item?.dtCreado
                                                                                    | date
                                                                                        : 'short'
                                                                            }}
                                                                        </div>
                                                                        <div
                                                                            [innerHTML]="
                                                                                item.cForoRptaRespuesta
                                                                            "
                                                                        ></div>
                                                                    </div>
                                                                    <br />
                                                                </div>
                                                                <hr />
                                                            }
                                                            <div
                                                                class="comment-container-Rpd"
                                                            >
                                                                <input
                                                                    type="text"
                                                                    class="inputRpd"
                                                                    placeholder="Escribe un comentario..."
                                                                    id="commentText"
                                                                    formControlName="cForoRptaPadre"
                                                                />
                                                                <button
                                                                    pButton
                                                                    type="button"
                                                                    class="p-button-text"
                                                                    (click)="
                                                                        sendCommentPadre(
                                                                            respuestas
                                                                        )
                                                                    "
                                                                >
                                                                    <i
                                                                        class="pi pi-send"
                                                                        style="
                                                                            font-size: 20px;
                                                                        "
                                                                    ></i>
                                                                </button>
                                                                <p-button
                                                                    icon="pi pi-times"
                                                                    [rounded]="
                                                                        true
                                                                    "
                                                                    [text]="
                                                                        true
                                                                    "
                                                                    severity="secondary"
                                                                    (click)="
                                                                        cancelarEdicion()
                                                                    "
                                                                />
                                                            </div>
                                                        </div>
                                                    </div>
                                                </p-button>
                                            </div>
                                        } @else {
                                            <app-empty-section
                                                class="w-full"
                                                [message]="'Ningun Comentario'"
                                            ></app-empty-section>
                                        }
                                    </ng-template>
                                </p-orderList>
                                <div class="comment-container">
                                    <input
                                        *ngIf="!showEditor"
                                        type="text"
                                        class="comment-input"
                                        placeholder="Escribe un comentario..."
                                        id="commentText"
                                        formControlName="cForoRptaRespuesta"
                                        (click)="toggleEditor()"
                                    />
                                    <div *ngIf="showEditor">
                                        <p-editor
                                            id="descripcion"
                                            placeholder="Escribe un Comentario... "
                                            formControlName="cForoRptaRespuesta"
                                        >
                                            <ng-template pTemplate="header">
                                                <span class="ql-formats">
                                                    <button
                                                        type="button"
                                                        class="ql-bold"
                                                        aria-label="Bold"
                                                    ></button>
                                                    <button
                                                        type="button"
                                                        class="ql-italic"
                                                        aria-label="Italic"
                                                    ></button>
                                                    <button
                                                        type="button"
                                                        class="ql-underline"
                                                        aria-label="Underline"
                                                    ></button>
                                                </span>
                                            </ng-template>
                                        </p-editor>

                                        <div class="reply-container">
                                            <div
                                                class="button-container"
                                                [hidden]="
                                                    iPerfilId !== ESTUDIANTE
                                                "
                                            >
                                                <button
                                                    pButton
                                                    pRipple
                                                    label="Cancelar"
                                                    icon="pi pi-times"
                                                    class="p-button-secondary mx-3"
                                                    type="button"
                                                    size="small"
                                                    (click)="closeEditor()"
                                                ></button>
                                                <button
                                                    pButton
                                                    pRipple
                                                    type="button"
                                                    label="Enviar"
                                                    icon="pi pi-send"
                                                    size="small"
                                                    class="p-button-primary"
                                                    (click)="sendComment()"
                                                ></button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- lista de participantes... -->
                            <div
                                class="col-12 md:col-4"
                                [hidden]="iPerfilId !== DOCENTE"
                            >
                                <div class="pb-2">
                                    <label
                                        for=""
                                        class=""
                                        style="
                                            font-weight: bold;
                                            font-size: 16px;
                                        "
                                        >Estudiantes:
                                    </label>
                                </div>
                                <p-orderList
                                    class="listAlumno"
                                    [value]="estudiantes"
                                    filterBy="nombrecompleto"
                                    filterPlaceholder="Buscar...."
                                >
                                    <ng-template
                                        let-estudiante
                                        of
                                        comentarios
                                        pTemplate="listItem"
                                        let-i="index"
                                    >
                                        <div
                                            class="perfilesList"
                                            tabindex="0"
                                            (click)="
                                                selecEstudiante(
                                                    estudiante.iEstudianteId
                                                )
                                            "
                                            (keydown.enter)="
                                                selecEstudiante(
                                                    estudiante.iEstudianteId
                                                )
                                            "
                                            [class.selected]="
                                                estudianteSelectComent ===
                                                estudiante.iEstudianteId
                                            "
                                        >
                                            <img
                                                src="assets/demo/images/matemit/perfil.png"
                                                alt=""
                                                class="w-3rem btn"
                                            />
                                            <!--class="w-4rem min-h-9 shadow-2 flex-shrink-0 border-round"-->
                                            <div class="perfil-name">
                                                {{ estudiante?.nombrecompleto }}
                                            </div>
                                            <div
                                                class="btn-calificar-comentario"
                                            >
                                                <p-button
                                                    icon="pi pi-book"
                                                    [rounded]="true"
                                                    [severity]="
                                                        estudiante?.cEstado ===
                                                        '0'
                                                            ? 'danger'
                                                            : 'success'
                                                    "
                                                    (click)="
                                                        openModalCalificacion(
                                                            estudiante
                                                        )
                                                    "
                                                    tooltipPosition="bottom"
                                                    pTooltip="Calificar"
                                                />
                                            </div>
                                        </div>
                                    </ng-template>
                                </p-orderList>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </p-tabPanel>
    </p-tabView>
</section>
<!-- Calificar estudiante en el mismo foro -->
<p-dialog
    [(visible)]="modelaCalificacionComen"
    [style]="{ width: '50%' }"
    class="p-fluid"
    header="Calificar a: {{ perfilSelect?.nombrecompleto }}"
    [modal]="true"
>
    <form [formGroup]="foroFormCalf" class="flex flex-column gap-3 w-full">
        <div class="grid pt-2">
            <!-- Mostrar la califcación comentada segun el requerimiento -->
            <!--  for="calificacion" [options]="calificacion"-->
            <!-- <div class="col-12">
                <p-inputGroup>
                    <p-inputGroupAddon> Calificación </p-inputGroupAddon>
                    <p-dropdown
                        formControlName="iEscalaCalifId"
                        [options]="calificacion"
                        optionValue="iEscalaCalifId"
                        optionLabel="cEscalaCalifNombre"
                        placeholder="Seleccione una Calificación"
                        [style]="{ width: '100%' }"
                        [showClear]="true"
                    ></p-dropdown>
                </p-inputGroup>
            </div> -->
            <!-- Mostrar descripción -->
            <div class="col-12">
                <label for="descripcion" class="font-bold mt-1"
                    >Descripción
                    <span class="text-red-500 text-xs"
                        >(*) Obligatorio</span
                    ></label
                >
                <div class="mt-2 pt-2">
                    <p-editor
                        id="descripcion"
                        formControlName="cForoRptaDocente"
                        [style]="{ height: '150px' }"
                    />
                </div>
            </div>
        </div>
    </form>
    <div class="reply-container">
        <div class="button-container">
            <button
                pButton
                pRipple
                label="Cancelar"
                icon="pi pi-times"
                class="p-button-secondary mx-3"
                type="button"
                size="small"
                (click)="display = true"
            ></button>
            <button
                pButton
                pRipple
                type="button"
                label="Enviar"
                icon="pi pi-send"
                size="small"
                class="p-button-primary"
                (click)="calificarComnt()"
            ></button>
        </div>
    </div>
</p-dialog>
<p-menu #menu [model]="menuItems" [popup]="true"> </p-menu>
