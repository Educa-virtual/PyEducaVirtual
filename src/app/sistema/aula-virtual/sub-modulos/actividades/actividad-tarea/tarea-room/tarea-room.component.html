<section class="flex flex-column gap-4">
    <p-tabView styleClass="actividad-tabs">
        <p-tabPanel>
            <ng-template pTemplate="header" class="header-fixed">
                <div class="flex align-items-center flex-column gap-2">
                    <app-icon name="matListAlt"></app-icon>
                    <span class="font-bold white-space-nowrap m-0">
                        Tarea
                    </span>
                </div>
            </ng-template>
            <div class="flex grid tab-content">
                <div
                    class="card"
                    [class]="iPerfilId !== 8 ? 'col-12' : 'col-6'"
                >
                    <h2>Tarea: {{ data?.cTareaTitulo }}</h2>
                    <div class="grid">
                        <div class="col-6 md:col-6 flex flex-column gap-2">
                            <span class="font-bold text-xl flex gap-2">
                                <app-icon
                                    name="matCalendarMonth"
                                    class="text-primary"
                                    size="sm"
                                ></app-icon>
                                Fecha inicio</span
                            >
                            <p>
                                {{ data?.dtTareaInicio | date }}

                                <span class="font-bold">Hora Limite: </span>
                                {{ data?.dtTareaInicio | date: 'shortTime' }}
                            </p>
                        </div>
                        <div class="col-12 md:col-6 flex flex-column gap-2">
                            <span class="font-bold text-xl flex gap-2">
                                <app-icon
                                    name="matCalendarMonth"
                                    class="text-primary"
                                    size="sm"
                                ></app-icon>
                                Fecha de Entrega</span
                            >
                            <p>
                                {{ data?.dtTareaFin | date }}
                                <span class="font-bold">Hora Limite: </span>
                                {{ data?.dtTareaFin | date: 'shortTime' }}
                            </p>
                        </div>
                    </div>
                    <div class="p-fluid">
                        <div class="p-field">
                            <p *ngIf="true">Para estudiantes</p>
                            <h3>
                                <label for="descripcion" class="p-text-bold"
                                    >Descripción de la tarea</label
                                >
                            </h3>
                            <div class="mt-2">
                                <div
                                    [innerHTML]="data?.cTareaDescripcion"
                                ></div>
                                <p-editor
                                    [(ngModel)]="cTareaDescripcion"
                                    [disabled]="true"
                                    id="descripcion"
                                    [style]="{ height: '150px' }"
                                    disabled
                                />
                            </div>
                            <!-- <div [innerHTML]="data?.cTareaDescripcion"></div>
                            <input
                                id="descripcion"
                                type="text"
                                pInputText
                                [value]="data?.cTareaDescripcion"
                                [disabled]="
                                    !data?.cTareaDescripcion || isDisabled
                                "
                                placeholder="Ingrese el título de la tarea"
                                class="p-inputtext-sm"
                            /> -->
                        </div>
                    </div>

                    <div>
                        <!-- Título para la sección de recursos -->
                        <h2>Recursos:</h2>
                        <app-recursos-lista [files]="FilesTareas">
                        </app-recursos-lista>
                    </div>
                </div>
                <!-- Esta tarjeta se muestra solo si iPerfilId es 8, lo que indica que solo ciertos usuarios pueden ver este contenido -->
                <div class="card col-6" [hidden]="iPerfilId !== 8">
                    <!-- Verifica si hay una tarea individual para el estudiante y no es una tarea grupal -->

                    @if (
                        iEstadoEstudianteTarea !== '' &&
                        !iEstadoEstudianteTareaGrupal
                    ) {
                        <!-- Esta sección solo se muestra si iEstadoEstudianteTarea es '0', lo que indica que la tarea no se ha entregado aún -->
                        <div
                            class="card-body m-3"
                            [hidden]="iEstadoEstudianteTarea !== '0'"
                        >
                            <h4>Tu Trabajo</h4>
                            <p-divider></p-divider>
                            <!-- Componente para subir archivos, configurado para recibir los archivos de tareas de estudiantes -->

                            <div
                                class="flex align-items-center justify-content-center"
                            >
                                <app-file-upload-primeng
                                    [nameFile]="'tareas-estudiantes'"
                                    [nameOption]="'tareas-estudiantes'"
                                    (actionFileUpload)="accionBtnItem($event)"
                                ></app-file-upload-primeng>
                            </div>
                            <!-- Lista de archivos adjuntos si existen archivos en FilesTareasEstudiantes -->
                            @if (FilesTareasEstudiantes.length) {
                                <div class="col-12">
                                    <label for="" class="mt-2"
                                        >Lista de Adjuntos</label
                                    >
                                    <!-- Itera sobre cada archivo adjunto en FilesTareasEstudiantes -->

                                    @for (
                                        item of FilesTareasEstudiantes;
                                        track item;
                                        let idx = $index
                                    ) {
                                        <p-inputGroup class="mt-1">
                                            <p-inputGroupAddon>
                                                <!-- Verifica el tipo de archivo y muestra un ícono -->

                                                @switch (item.type) {
                                                    @case (1) {
                                                        <i
                                                            class="pi pi-upload"
                                                            style="
                                                                color: #333437;
                                                            "
                                                        ></i>
                                                    }
                                                }
                                            </p-inputGroupAddon>
                                            <!-- Muestra el nombre del archivo, deshabilitado para no ser editable -->
                                            <input
                                                type="text"
                                                pInputText
                                                [placeholder]="item.name"
                                                disabled
                                            />
                                            <button
                                                type="button"
                                                pButton
                                                icon="pi pi-trash"
                                                (click)="
                                                    FilesTareasEstudiantes.splice(
                                                        idx,
                                                        1
                                                    )
                                                "
                                                class="p-button-danger"
                                            >
                                                &nbsp;
                                                <!-- Botón para eliminar el archivo del array FilesTareasEstudiantes -->
                                            </button>
                                        </p-inputGroup>
                                    }
                                </div>
                            }
                            <p-divider></p-divider>

                            <!-- Botón para enviar la tarea -->
                            <div
                                class="flex align-items-center justify-content-center"
                            >
                                <p-toast></p-toast>
                                <p-button
                                    label="Enviar Tarea"
                                    icon="pi pi-check"
                                    iconPos="right"
                                    (onClick)="entregarEstudianteTarea()"
                                    raised
                                    severity="success"
                                ></p-button>
                            </div>
                        </div>
                        <!-- Muestra mensaje de tarea evaluada si el estado de la tarea es '1' -->

                        <div
                            class="card-body m-3"
                            [hidden]="iEstadoEstudianteTarea !== '1'"
                        >
                            <h4 class="mb-3">Tu Trabajo ya ha sido evaluado</h4>

                            <p-divider class="mb-3"></p-divider>
                            <!-- Campo de texto para mostrar la calificación -->
                            <div class="p-field p-fluid mb-3">
                                <label for="notaEstudiante"
                                    >Escala Calificación</label
                                >
                                <input
                                    id="notaEstudiante"
                                    type="text"
                                    pInputText
                                    [(ngModel)]="notaTareaEstudiante"
                                    class="p-inputtext-lg"
                                    placeholder="Aqui muestra la calificación"
                                    [disabled]="isDisabled"
                                />
                            </div>
                            <p-divider class="mb-3"></p-divider>
                            <!-- Campo de texto para el comentario del docente -->
                            <div class="p-field p-fluid mb-3">
                                <label for="comentarioDocente"
                                    >Comentario Docente</label
                                >
                                <textarea
                                    id="comentarioDocente"
                                    pInputTextarea
                                    rows="5"
                                    [(ngModel)]="comentarioTareaEstudiante"
                                    class="p-inputtextarea-lg"
                                    placeholder="Muestra Comentario Docente"
                                    [disabled]="isDisabled"
                                ></textarea>
                            </div>
                        </div>
                    }
                    <!-- Si no hay tarea individual y existe una tarea grupal -->
                    @if (
                        !iEstadoEstudianteTarea &&
                        iEstadoEstudianteTareaGrupal !== ''
                    ) {
                        <div
                            class="card-body m-3"
                            [hidden]="iEstadoEstudianteTareaGrupal !== '0'"
                        >
                            <!-- Esta sección es para la entrega de tarea grupal y se muestra si el estado es '0' -->

                            <h3>Trabajo Grupal</h3>
                            <p-divider></p-divider>
                            <!-- Componente de subida de archivos para tareas grupales -->
                            <div
                                class="flex align-items-center justify-content-center"
                            >
                                <app-file-upload-primeng
                                    [nameFile]="'tarea-cabecera-grupos'"
                                    [nameOption]="'tarea-cabecera-grupos'"
                                    (actionFileUpload)="accionBtnItem($event)"
                                ></app-file-upload-primeng>
                            </div>
                            <!-- Lista de archivos adjuntos para la tarea grupal -->
                            @if (FilesTareasEstudiantesGrupal.length) {
                                <div class="col-12">
                                    <label for="" class="mt-2"
                                        >Lista de Adjuntos</label
                                    >
                                    <!-- Itera sobre cada archivo adjunto en FilesTareasEstudiantesGrupal -->
                                    @for (
                                        item of FilesTareasEstudiantesGrupal;
                                        track item;
                                        let idx = $index
                                    ) {
                                        <p-inputGroup class="mt-1">
                                            <p-inputGroupAddon>
                                                <!-- Muestra un ícono basado en el tipo de archivo -->
                                                @switch (item.type) {
                                                    @case (1) {
                                                        <i
                                                            class="pi pi-upload"
                                                            style="
                                                                color: #333437;
                                                            "
                                                        ></i>
                                                    }
                                                }
                                                <!-- Muestra el nombre del archivo y un botón para eliminarlo -->
                                            </p-inputGroupAddon>
                                            <input
                                                type="text"
                                                pInputText
                                                [placeholder]="item.name"
                                                disabled
                                            />
                                            <!-- Botón para enviar la tarea grupal -->
                                            <button
                                                type="button"
                                                pButton
                                                icon="pi pi-trash"
                                                (click)="
                                                    FilesTareasEstudiantesGrupal.splice(
                                                        idx,
                                                        1
                                                    )
                                                "
                                                class="p-button-danger"
                                            >
                                                &nbsp;
                                            </button>
                                        </p-inputGroup>
                                    }
                                </div>
                            }
                            <p-divider></p-divider>
                            <p-toast></p-toast>
                            <div
                                class="flex align-items-center justify-content-center"
                            >
                                <p-button
                                    label="Enviar Tarea"
                                    icon="pi pi-check"
                                    iconPos="right"
                                    (onClick)="entregarEstudianteTareaGrupal()"
                                    raised
                                    severity="success"
                                ></p-button>
                            </div>
                        </div>
                        <div
                            class="card-body m-3"
                            [hidden]="iEstadoEstudianteTareaGrupal !== '1'"
                        >
                            <h4>El Trabajo grupal ya ha sido evaluado</h4>
                            <p-divider></p-divider>
                            <p-inputGroup>
                                <p-inputGroupAddon>
                                    Escala de Calificación
                                </p-inputGroupAddon>
                                <input
                                    pInputText
                                    [(ngModel)]="notaTareaEstudianteGrupal"
                                />
                            </p-inputGroup>
                            <p-divider></p-divider>
                            <p-inputGroup>
                                <p-inputGroupAddon>
                                    Conclusión Descriptiva
                                </p-inputGroupAddon>
                                <textarea
                                    pInputText
                                    rows="5"
                                    [(ngModel)]="
                                        comentarioTareaEstudianteGrupal
                                    "
                                ></textarea>
                            </p-inputGroup>
                        </div>
                    }
                </div>
            </div>
        </p-tabPanel>
        @if (iPerfilId !== 8) {
            <p-tabPanel>
                <ng-template pTemplate="header" class="header-fixed">
                    <div class="flex align-items-center flex-column gap-2">
                        <app-icon name="matPeople"></app-icon>
                        <span class="font-bold white-space-nowrap m-0">
                            Actividad de los alumnos
                        </span>
                    </div>
                </ng-template>
                <div class="flex flex-column gap-4 tab-content">
                    <div class="grid">
                        <div class="col-12 md:col-5">
                            <p-toolbar>
                                <div class="p-toolbar-group-start">
                                    <h4 class="text-primary font-bold">
                                        Asignar a:
                                    </h4>
                                </div>
                                <div class="p-toolbar-group-center">
                                    <p-selectButton
                                        [options]="tareaOptions"
                                        [(ngModel)]="tareaAsignar"
                                        [multiple]="false"
                                        optionLabel="name"
                                        optionValue="value"
                                        (onChange)="updateTareas()"
                                    />
                                </div>
                                <div class="p-toolbar-group-end">
                                    <!-- estes boto esta desactivado-->
                                    <!-- <p-button icon="pi pi-sync" pTooltip="Refrescar Listas" tooltipPosition="top"
                                    [rounded]="true" [text]="true" severity="danger" /> -->
                                </div>
                            </p-toolbar>
                            <p-divider></p-divider>
                            @if (tareaAsignar !== undefined) {
                                <p-accordion [activeIndex]="0">
                                    @if (!tareaAsignar) {
                                        <p-accordionTab header="Individual">
                                            <div class="grid">
                                                <div
                                                    class="col-6 leyenda-tareas"
                                                >
                                                    <div
                                                        class="flex align-items-center"
                                                    >
                                                        <div
                                                            class="w-1rem h-1rem border-circle"
                                                            [ngClass]="
                                                                'bg-red-500'
                                                            "
                                                        ></div>
                                                        <div>
                                                            <b
                                                                style="
                                                                    font-size: 1.5rem;
                                                                "
                                                                >&nbsp;{{
                                                                    tareasFalta
                                                                }}</b
                                                            ><small
                                                                >&nbsp;
                                                                Falta</small
                                                            >
                                                        </div>
                                                    </div>
                                                </div>

                                                <div
                                                    class="col-6 leyenda-tareas"
                                                >
                                                    <div
                                                        class="flex align-items-center"
                                                    >
                                                        <div
                                                            class="w-1rem h-1rem border-circle"
                                                            [ngClass]="
                                                                'bg-green-500'
                                                            "
                                                        ></div>
                                                        <div>
                                                            <b
                                                                style="
                                                                    font-size: 1.5rem;
                                                                "
                                                                >&nbsp;{{
                                                                    tareasCulminado
                                                                }}</b
                                                            ><small
                                                                >&nbsp;Culminado
                                                            </small>
                                                        </div>
                                                    </div>
                                                </div>
                                                <p-table
                                                    #dv
                                                    class="col-12 hoverTable"
                                                    [value]="estudiantes"
                                                    paginator="false"
                                                    [globalFilterFields]="[
                                                        'cPersPaterno',
                                                        'cPersMaterno',
                                                        'cPersNombre',
                                                    ]"
                                                    styleClass="p-datatable-sm"
                                                    [scrollable]="true"
                                                    scrollHeight="300px"
                                                >
                                                    <ng-template
                                                        pTemplate="caption"
                                                    >
                                                        <div
                                                            class="flex justify-content-between gap-2 flex-column sm:flex-row flex-wrap"
                                                        >
                                                            <p-iconField
                                                                iconPosition="left"
                                                            >
                                                                <p-inputIcon
                                                                    styleClass="pi pi-search text-md"
                                                                />
                                                                <input
                                                                    pInputText
                                                                    type="text"
                                                                    class="py-2"
                                                                    (input)="
                                                                        onGlobalFilter(
                                                                            dv,
                                                                            $event
                                                                        )
                                                                    "
                                                                    placeholder="Buscar por apellidos y nombres"
                                                                />
                                                            </p-iconField>
                                                        </div>
                                                    </ng-template>
                                                    <ng-template
                                                        pTemplate="header"
                                                    >
                                                        <tr
                                                            class="sticky-header th"
                                                        >
                                                            <th>#</th>
                                                            <th>Apellidos</th>
                                                            <th>Nombres</th>
                                                            <th>Estado</th>
                                                        </tr>
                                                    </ng-template>

                                                    <ng-template
                                                        pTemplate="body"
                                                        let-estudiante
                                                        let-rowIndex="rowIndex"
                                                    >
                                                        <tr
                                                            (click)="
                                                                getTareaRealizada(
                                                                    estudiante
                                                                );
                                                                nEstudiante =
                                                                    rowIndex
                                                            "
                                                            [class]="
                                                                nEstudiante ===
                                                                rowIndex
                                                                    ? 'bg-green-200'
                                                                    : ''
                                                            "
                                                        >
                                                            <td>
                                                                {{
                                                                    rowIndex + 1
                                                                }}
                                                            </td>
                                                            <td>
                                                                {{
                                                                    estudiante.cPersPaterno
                                                                }}

                                                                {{
                                                                    estudiante.cPersMaterno
                                                                }}
                                                            </td>
                                                            <td>
                                                                {{
                                                                    estudiante?.cPersNombre
                                                                }}
                                                            </td>

                                                            <td
                                                                style="
                                                                    text-align: center;
                                                                "
                                                            >
                                                                <div
                                                                    class="w-1rem h-1rem border-circle ml-3"
                                                                    [ngClass]="
                                                                        estudiante.cEstado ===
                                                                        '0'
                                                                            ? 'bg-red-500'
                                                                            : estudiante.cEstado ===
                                                                                '2'
                                                                              ? 'bg-yellow-500'
                                                                              : 'bg-green-500'
                                                                    "
                                                                ></div>
                                                            </td>
                                                        </tr>
                                                    </ng-template>

                                                    <ng-template
                                                        pTemplate="emptymessage"
                                                        let-columns
                                                    >
                                                        <tr>
                                                            <td
                                                                [attr.colspan]="
                                                                    8
                                                                "
                                                            >
                                                                No se
                                                                encontraron
                                                                resultados.
                                                            </td>
                                                        </tr>
                                                    </ng-template>
                                                </p-table>
                                            </div>
                                        </p-accordionTab>
                                    } @else {
                                        <p-accordionTab header="Grupal">
                                            <div class="grid text-center">
                                                <div
                                                    class="col-6 leyenda-tareas"
                                                >
                                                    <div
                                                        class="flex align-items-center"
                                                    >
                                                        <div
                                                            class="w-1rem h-1rem border-circle"
                                                            [ngClass]="
                                                                'bg-red-500'
                                                            "
                                                        ></div>
                                                        <div>
                                                            <b
                                                                style="
                                                                    font-size: 1.5rem;
                                                                "
                                                                >&nbsp;{{
                                                                    tareasFalta
                                                                }}</b
                                                            ><small
                                                                >&nbsp;
                                                                Falta</small
                                                            >
                                                        </div>
                                                    </div>
                                                </div>

                                                <div
                                                    class="col-6 leyenda-tareas"
                                                >
                                                    <div
                                                        class="flex align-items-center"
                                                    >
                                                        <div
                                                            class="w-1rem h-1rem border-circle"
                                                            [ngClass]="
                                                                'bg-green-500'
                                                            "
                                                        ></div>
                                                        <div>
                                                            <b
                                                                style="
                                                                    font-size: 1.5rem;
                                                                "
                                                                >&nbsp;{{
                                                                    tareasCulminado
                                                                }}</b
                                                            ><small
                                                                >&nbsp;
                                                                Culminado</small
                                                            >
                                                        </div>
                                                    </div>
                                                </div>
                                                <!-- <div class="col-6">
                                        <span class="p-input-icon-left">
                                            <i class="pi pi-search"></i>
                                            <input pInputText placeholder="Buscar estudiante" style="width: 250px" />
                                        </span>
                                    </div> -->

                                                <div class="col-12 text-right">
                                                    <p-button
                                                        label="Crear Grupo"
                                                        icon="pi pi-plus"
                                                        (onClick)="
                                                            grupoSeleccionado =
                                                                null;
                                                            showModal = true
                                                        "
                                                        iconPos="left"
                                                    />
                                                </div>
                                                <div class="col-12">
                                                    <p-accordion
                                                        [activeIndex]="0"
                                                        class="w-full"
                                                        expandIcon="pi pi-plus"
                                                        collapseIcon="pi pi-minus"
                                                    >
                                                        @for (
                                                            item of grupos;
                                                            track item;
                                                            let idx = $index
                                                        ) {
                                                            <p-accordionTab
                                                                (click)="
                                                                    seleccionarGrupo(
                                                                        item
                                                                    );
                                                                    nGrupal =
                                                                        idx
                                                                "
                                                                [ngClass]="{
                                                                    grupal:
                                                                        nGrupal ===
                                                                        idx,
                                                                }"
                                                            >
                                                                <ng-template
                                                                    pTemplate="header"
                                                                >
                                                                    <div
                                                                        class="flex align-items-center gap-2 w-full"
                                                                    >
                                                                        Grupo:
                                                                        {{
                                                                            item.cTareaGrupoNombre
                                                                        }}
                                                                        &nbsp;
                                                                    </div>
                                                                    <div
                                                                        class="flex align-items-center"
                                                                    >
                                                                        <!-- <b>Calif: </b>
                                                        {{
                                                        item.cEscalaCalifNombre ||
                                                        '-'
                                                        }} -->
                                                                        <div
                                                                            class="w-1rem h-1rem border-circle ml-3"
                                                                            [ngClass]="
                                                                                item.cEstado ===
                                                                                '0'
                                                                                    ? 'bg-red-500'
                                                                                    : item.cEstado ===
                                                                                        '2'
                                                                                      ? 'bg-yellow-500'
                                                                                      : 'bg-green-500'
                                                                            "
                                                                        ></div>

                                                                        <p-button
                                                                            icon="pi pi-pencil"
                                                                            [rounded]="
                                                                                true
                                                                            "
                                                                            [text]="
                                                                                true
                                                                            "
                                                                            class="ml-3"
                                                                            severity="info"
                                                                            (onClick)="
                                                                                grupoSeleccionado =
                                                                                    item;
                                                                                showModal = true
                                                                            "
                                                                        />
                                                                        <p-button
                                                                            icon="pi pi-trash"
                                                                            [rounded]="
                                                                                true
                                                                            "
                                                                            [text]="
                                                                                true
                                                                            "
                                                                            severity="danger"
                                                                            (onClick)="
                                                                                eliminarTareaCabeceraGrupos(
                                                                                    item
                                                                                )
                                                                            "
                                                                        />
                                                                    </div>
                                                                </ng-template>

                                                                <div>
                                                                    <p-table
                                                                        #dv
                                                                        class="col-12 hoverTable"
                                                                        [value]="
                                                                            item.json_estudiantes_asignado
                                                                        "
                                                                        paginator="false"
                                                                        styleClass="p-datatable-sm"
                                                                        [globalFilterFields]="[
                                                                            'cPersPaterno',
                                                                            'cPersMaterno',
                                                                            'cPersNombre',
                                                                        ]"
                                                                    >
                                                                        <ng-template
                                                                            pTemplate="caption"
                                                                        >
                                                                            <div
                                                                                class="flex justify-content-between gap-2 flex-column sm:flex-row flex-wrap"
                                                                            >
                                                                                <p-iconField
                                                                                    iconPosition="left"
                                                                                >
                                                                                    <p-inputIcon
                                                                                        styleClass="pi pi-search text-md"
                                                                                    />
                                                                                    <input
                                                                                        pInputText
                                                                                        type="text"
                                                                                        class="py-2"
                                                                                        (input)="
                                                                                            onGlobalFilter(
                                                                                                dv,
                                                                                                $event
                                                                                            )
                                                                                        "
                                                                                        placeholder="Buscar por apellidos y nombres"
                                                                                    />
                                                                                </p-iconField>
                                                                            </div>
                                                                        </ng-template>
                                                                        <ng-template
                                                                            pTemplate="header"
                                                                        >
                                                                            <tr
                                                                                class="sticky-header"
                                                                            >
                                                                                <th>
                                                                                    #
                                                                                </th>
                                                                                <th>
                                                                                    Apellidos
                                                                                </th>
                                                                                <th>
                                                                                    Nombres
                                                                                </th>
                                                                                <th>
                                                                                    Acciones
                                                                                </th>
                                                                            </tr>
                                                                        </ng-template>
                                                                        <ng-template
                                                                            pTemplate="body"
                                                                            let-estudiante
                                                                            let-rowIndex="rowIndex"
                                                                        >
                                                                            @if (
                                                                                estudiante.bAsignado
                                                                            ) {
                                                                                <tr>
                                                                                    <td>
                                                                                        {{
                                                                                            rowIndex +
                                                                                                1
                                                                                        }}
                                                                                    </td>
                                                                                    <td>
                                                                                        {{
                                                                                            estudiante.cPersPaterno
                                                                                        }}
                                                                                        {{
                                                                                            estudiante.cPersMaterno
                                                                                        }}
                                                                                    </td>
                                                                                    <td>
                                                                                        {{
                                                                                            estudiante?.cPersNombre
                                                                                        }}
                                                                                    </td>
                                                                                    <td>
                                                                                        <!-- <p-button icon="pi pi-reply" [rounded]="
                                                                                                true
                                                                                            " [text]="
                                                                                                true
                                                                                            " severity="danger"
                                                                        (onClick)="
                                                                                                transferirEstudiante(
                                                                                                    estudiante
                                                                                                )
                                                                                            " /> -->

                                                                                        <p-button
                                                                                            icon="pi pi-trash"
                                                                                            [rounded]="
                                                                                                true
                                                                                            "
                                                                                            [text]="
                                                                                                true
                                                                                            "
                                                                                            severity="danger"
                                                                                            (onClick)="
                                                                                                eliminarEstudiante(
                                                                                                    estudiante
                                                                                                )
                                                                                            "
                                                                                        />
                                                                                    </td>
                                                                                </tr>
                                                                            }
                                                                        </ng-template>
                                                                        <ng-template
                                                                            pTemplate="emptymessage"
                                                                            let-columns
                                                                        >
                                                                            <tr>
                                                                                <td
                                                                                    [attr.colspan]="
                                                                                        4
                                                                                    "
                                                                                >
                                                                                    No
                                                                                    se
                                                                                    encontraron
                                                                                    resultados.
                                                                                </td>
                                                                            </tr>
                                                                        </ng-template>
                                                                    </p-table>
                                                                </div>
                                                            </p-accordionTab>
                                                        }
                                                    </p-accordion>
                                                </div>
                                            </div>
                                        </p-accordionTab>
                                    }
                                </p-accordion>
                            }
                        </div>
                        <div class="col-12 md:col-7">
                            <p-toolbar>
                                <div class="p-toolbar-group-start">
                                    <h4>
                                        <div class="text-primary font-bold">
                                            <i class="pi pi-pen-to-square"></i
                                            >&nbsp; Desarrollo de la tarea
                                        </div>
                                    </h4>
                                </div>
                                <div class="p-toolbar-group-end">
                                    <!-- <p-button icon="pi pi-sync" pTooltip="Refrescar Tarea" tooltipPosition="top"
                                    [rounded]="true" [text]="true" severity="danger" /> -->
                                </div>
                            </p-toolbar>
                            <p-divider></p-divider>
                            @if (this.tareaAsignar !== null) {
                                <div [hidden]="this.tareaAsignar">
                                    @if (!estudianteSeleccionado) {
                                        <div align="center">
                                            <span
                                                class="pi pi-folder-open"
                                                style="font-size: 8rem"
                                            ></span>
                                        </div>
                                        <p class="text-center mt-2">
                                            Seleccione un estudiante para ver el
                                            desarrollo de su tarea
                                        </p>
                                    } @else {
                                        <p-message
                                            severity="info"
                                            [text]="
                                                'Estudiante: ' +
                                                estudianteSeleccionado.cPersNombre +
                                                ' ' +
                                                estudianteSeleccionado.cPersPaterno +
                                                ' ' +
                                                estudianteSeleccionado.cPersMaterno
                                            "
                                            styleClass="p-mr-2 w-full"
                                        ></p-message>
                                        <p-divider></p-divider>
                                        <p-fieldset
                                            [legend]="cTareaTitulo"
                                            [toggleable]="true"
                                        >
                                            <div class="grid">
                                                @if (
                                                    cTareaEstudianteUrlEstudiante.length
                                                ) {
                                                    <div class="col-12">
                                                        <label
                                                            for=""
                                                            class="mt-2"
                                                            >Lista de
                                                            Adjuntos</label
                                                        >

                                                        @for (
                                                            item of cTareaEstudianteUrlEstudiante;
                                                            track item;
                                                            let idx = $index
                                                        ) {
                                                            <p-inputGroup
                                                                class="mt-1"
                                                            >
                                                                <p-inputGroupAddon>
                                                                    @switch (
                                                                        item.type
                                                                    ) {
                                                                        @case (
                                                                            1
                                                                        ) {
                                                                            <i
                                                                                class="pi pi-upload"
                                                                                style="
                                                                                    color: #333437;
                                                                                "
                                                                            ></i>
                                                                        }
                                                                        @case (
                                                                            2
                                                                        ) {
                                                                            <i
                                                                                class="pi pi-link"
                                                                                style="
                                                                                    color: #333437;
                                                                                "
                                                                            ></i>
                                                                        }
                                                                        @case (
                                                                            3
                                                                        ) {
                                                                            <i
                                                                                class="pi pi-youtube"
                                                                                style="
                                                                                    color: #c4302b;
                                                                                "
                                                                            ></i>
                                                                        }
                                                                        @case (
                                                                            4
                                                                        ) {
                                                                            <i
                                                                                class="pi pi-folder"
                                                                                style="
                                                                                    color: #ffd04b;
                                                                                "
                                                                            ></i>
                                                                        }
                                                                    }
                                                                </p-inputGroupAddon>
                                                                <input
                                                                    type="text"
                                                                    pInputText
                                                                    [placeholder]="
                                                                        item.name
                                                                    "
                                                                    disabled
                                                                />
                                                                <button
                                                                    type="button"
                                                                    pButton
                                                                    icon="pi pi-eye"
                                                                    (click)="
                                                                        goLinkDocumento(
                                                                            item.ruta
                                                                        )
                                                                    "
                                                                    class="p-button-info"
                                                                >
                                                                    &nbsp;
                                                                </button>
                                                            </p-inputGroup>
                                                        }
                                                    </div>
                                                } @else {
                                                    <p class="text-danger">
                                                        Todavía el estudiante no
                                                        ha entregado su tarea
                                                    </p>
                                                }
                                            </div>
                                        </p-fieldset>
                                        <p-divider></p-divider>
                                        <p-fieldset
                                            legend="Calificación"
                                            [toggleable]="true"
                                        >
                                            <div class="grid">
                                                <div class="col-12">
                                                    <p-inputGroup>
                                                        <p-inputGroupAddon
                                                            >Escala de
                                                            calificación</p-inputGroupAddon
                                                        >
                                                        <p-dropdown
                                                            [(ngModel)]="
                                                                iEscalaCalifId
                                                            "
                                                            [options]="
                                                                escalaCalificaciones
                                                            "
                                                            optionValue="iEscalaCalifId"
                                                            optionLabel="cEscalaCalifNombre"
                                                            placeholder="Seleccione calificación"
                                                            [style]="{
                                                                width: '100%',
                                                            }"
                                                        ></p-dropdown>
                                                    </p-inputGroup>
                                                </div>
                                                <div class="col-12">
                                                    <p-inputGroup>
                                                        <p-inputGroupAddon>
                                                            Conclusión
                                                            Descriptiva
                                                        </p-inputGroupAddon>
                                                        <textarea
                                                            pInputText
                                                            [(ngModel)]="
                                                                cTareaEstudianteComentarioDocente
                                                            "
                                                        ></textarea>
                                                    </p-inputGroup>
                                                </div>
                                            </div>
                                        </p-fieldset>
                                        <div class="grid">
                                            <div
                                                class="col-12 text-right fixed-button text-center"
                                            >
                                                <p-toast></p-toast>
                                                <p-button
                                                    severity="success"
                                                    label="Guardar"
                                                    icon="pi pi-plus"
                                                    iconPos="left"
                                                    (onClick)="
                                                        guardarTareaEstudiantesxDocente()
                                                    "
                                                />
                                            </div>
                                        </div>
                                    }
                                </div>
                                <div [hidden]="!this.tareaAsignar">
                                    <!-- {{grupoSeleccionadoCalificar  | json}} -->
                                    @if (!grupoSeleccionadoCalificar.length) {
                                        <div align="center">
                                            <span
                                                class="pi pi-folder-open"
                                                style="font-size: 8rem"
                                            ></span>
                                        </div>
                                        <p class="text-center mt-2">
                                            Seleccione un grupo para ver el
                                            desarrollo de su tarea
                                        </p>
                                    } @else {
                                        <p-message
                                            severity="info"
                                            [text]="
                                                grupoSeleccionadoCalificar[0]
                                                    .cTareaGrupoNombre
                                            "
                                            styleClass="p-mr-2 w-full"
                                        ></p-message>
                                        <div class="mt-1">
                                            <b>Integrantes:</b>
                                        </div>
                                        @for (
                                            item of grupoSeleccionadoCalificar[0]
                                                .json_estudiantes;
                                            track item
                                        ) {
                                            @if (item.bAsignado) {
                                                <div>
                                                    - {{ item.cPersNombre }}
                                                    {{ item.cPersPaterno }}
                                                    {{ item.cPersMaterno }}
                                                </div>
                                            }
                                            <!-- <p-message severity="info"
                                [text]="'Estudiante: '+ item.cPersNombre +' '+ item.cPersPaterno +' '+ item.cPersMaterno"
                                styleClass="p-mr-2"></p-message> -->
                                        }
                                        <p-divider></p-divider>
                                        <p-fieldset
                                            [legend]="cTareaTitulo"
                                            [toggleable]="true"
                                        >
                                            <div class="grid">
                                                @if (cTareaGrupoUrl.length) {
                                                    <div class="col-12">
                                                        <label
                                                            for=""
                                                            class="mt-2"
                                                            >Lista de
                                                            Adjuntos</label
                                                        >

                                                        @for (
                                                            item of cTareaGrupoUrl;
                                                            track item;
                                                            let idx = $index
                                                        ) {
                                                            <p-inputGroup
                                                                class="mt-1"
                                                            >
                                                                <p-inputGroupAddon>
                                                                    @switch (
                                                                        item.type
                                                                    ) {
                                                                        @case (
                                                                            1
                                                                        ) {
                                                                            <i
                                                                                class="pi pi-upload"
                                                                                style="
                                                                                    color: #333437;
                                                                                "
                                                                            ></i>
                                                                        }
                                                                        @case (
                                                                            2
                                                                        ) {
                                                                            <i
                                                                                class="pi pi-link"
                                                                                style="
                                                                                    color: #333437;
                                                                                "
                                                                            ></i>
                                                                        }
                                                                        @case (
                                                                            3
                                                                        ) {
                                                                            <i
                                                                                class="pi pi-youtube"
                                                                                style="
                                                                                    color: #c4302b;
                                                                                "
                                                                            ></i>
                                                                        }
                                                                        @case (
                                                                            4
                                                                        ) {
                                                                            <i
                                                                                class="pi pi-folder"
                                                                                style="
                                                                                    color: #ffd04b;
                                                                                "
                                                                            ></i>
                                                                        }
                                                                    }
                                                                </p-inputGroupAddon>
                                                                <input
                                                                    type="text"
                                                                    pInputText
                                                                    [placeholder]="
                                                                        item.name
                                                                    "
                                                                    disabled
                                                                />
                                                                <button
                                                                    type="button"
                                                                    pButton
                                                                    icon="pi pi-eye"
                                                                    (click)="
                                                                        goLinkDocumento(
                                                                            item.ruta
                                                                        )
                                                                    "
                                                                    class="p-button-info"
                                                                >
                                                                    &nbsp;
                                                                </button>
                                                            </p-inputGroup>
                                                        }
                                                    </div>
                                                } @else {
                                                    <p class="text-danger">
                                                        Todavía el grupo no ha
                                                        entregado su tarea
                                                    </p>
                                                }
                                            </div>
                                        </p-fieldset>
                                        <p-divider></p-divider>
                                        <p-fieldset
                                            legend="Calificación"
                                            [toggleable]="true"
                                        >
                                            <div class="grid">
                                                <div class="col-12">
                                                    <p-inputGroup>
                                                        <p-inputGroupAddon
                                                            >Escala de
                                                            calificación</p-inputGroupAddon
                                                        >
                                                        <p-dropdown
                                                            [(ngModel)]="
                                                                iEscalaCalifId
                                                            "
                                                            [options]="
                                                                escalaCalificaciones
                                                            "
                                                            optionValue="iEscalaCalifId"
                                                            optionLabel="cEscalaCalifNombre"
                                                            placeholder="Seleccione calificación"
                                                            [style]="{
                                                                width: '100%',
                                                            }"
                                                        ></p-dropdown>
                                                    </p-inputGroup>
                                                </div>
                                                <div class="col-12">
                                                    <p-inputGroup>
                                                        <p-inputGroupAddon>
                                                            Conclusión
                                                            Descriptiva
                                                        </p-inputGroupAddon>
                                                        <textarea
                                                            pInputText
                                                            [(ngModel)]="
                                                                cTareaGrupoComentarioDocente
                                                            "
                                                        ></textarea>
                                                    </p-inputGroup>
                                                </div>
                                            </div>
                                        </p-fieldset>
                                        <div class="grid">
                                            <div
                                                class="col-12 text-right fixed-button text-center"
                                            >
                                                <p-toast></p-toast>
                                                <p-button
                                                    severity="success"
                                                    label="Guardar"
                                                    icon="pi pi-plus"
                                                    iconPos="left"
                                                    (onClick)="
                                                        guardarTareaCabeceraGruposxDocente()
                                                    "
                                                    type="button"
                                                ></p-button>
                                            </div>
                                        </div>
                                    }
                                </div>
                            }
                        </div>
                    </div>
                </div>
            </p-tabPanel>
        }
    </p-tabView>

    <app-form-grupo
        [iTareaId]="iTareaId"
        [data]="grupoSeleccionado"
        [showModal]="showModal"
        (accionBtnItem)="accionBtnItem($event)"
    ></app-form-grupo>
</section>
<app-form-transferir-grupo
    [showModalTransferir]="showModalTransferir"
    [grupos]="grupos"
    [iTareaEstudianteId]="iTareaEstudianteIdGrupo"
    [iEstudianteId]="iEstudianteIdGrupo"
    (accionBtnItem)="accionBtnItem($event)"
></app-form-transferir-grupo>
<p-confirmDialog />
