<p-breadcrumb class="max-w-full" [model]="breadCrumbItems" [home]="breadCrumbHome" />

<p-panel>
  <ng-template pTemplate="header">
    <span class="text-2xl text-uppercase">
      <div class="flex flex-column">
        <div class="flex text-xl">GESTIONAR RESPUESTAS DE ENCUESTA</div>
        <div class="flex text-sm">{{ cEncuNombre }}</div>
      </div>
    </span>
  </ng-template>
  <ng-template pTemplate="icons" class="flex justify-content-center">
    <button pButton pRipple class="p-button-success" (click)="exportarExcel()">
      <i class="pi pi-download"></i>
      <span class="hidden sm:block ml-2">Exportar</span>
    </button>
  </ng-template>
  <div style="position: relative; display: block">
    <div class="grid mb-3">
      <div class="col-12 md:col-fixed" style="width: auto">
        <p-button
          #overlayAnchor
          (click)="filtros.toggle($event)"
          icon="pi pi-filter"
          class="w-full"
          severity="success"
          [label]="'Ver filtros aplicados (' + filtros_aplicados + ')'"
        />
        <p-overlayPanel
          #filtros
          [appendTo]="overlayAnchorRef"
          [dismissable]="false"
          [showCloseIcon]="true"
          [style]="{ width: '100%', maxWidth: '600px' }"
        >
          <ng-template pTemplate="content">
            <form [formGroup]="formFiltros" class="p-fluid">
              <div class="grid">
                <div class="col-12 md:col-6">
                  <p-inputGroup title="* Campo obligatorio">
                    <p-inputGroupAddon>Nivel</p-inputGroupAddon>
                    <p-dropdown
                      [options]="nivel_tipos"
                      [showClear]="es_especialista"
                      formControlName="iNivelTipoId"
                      placeholder="Seleccione un nivel"
                      styleClass="group-element"
                      appendTo="body"
                      (click)="$event.stopPropagation()"
                    ></p-dropdown>
                  </p-inputGroup>
                </div>
                <div class="col-12 md:col-6">
                  <p-inputGroup title="* Campo obligatorio">
                    <p-inputGroupAddon>Grado</p-inputGroupAddon>
                    <p-dropdown
                      [options]="nivel_grados"
                      showClear="true"
                      formControlName="iNivelGradoId"
                      placeholder="Seleccione un grado"
                      styleClass="group-element"
                      filter="true"
                      appendTo="body"
                      (click)="$event.stopPropagation()"
                    ></p-dropdown>
                  </p-inputGroup>
                </div>
                <div class="col-12 md:col-6" *ngIf="es_especialista">
                  <p-inputGroup>
                    <p-inputGroupAddon>Gestión</p-inputGroupAddon>
                    <p-dropdown
                      [options]="tipo_sectores"
                      showClear="true"
                      formControlName="iTipoSectorId"
                      placeholder="Seleccione un tipo de gestión"
                      styleClass="group-element"
                      appendTo="body"
                      (click)="$event.stopPropagation()"
                    ></p-dropdown>
                  </p-inputGroup>
                </div>
                <div class="col-12 md:col-6" *ngIf="es_especialista">
                  <p-inputGroup>
                    <p-inputGroupAddon>Zona</p-inputGroupAddon>
                    <p-dropdown
                      [options]="zonas"
                      showClear="true"
                      formControlName="iZonaId"
                      placeholder="Seleccione un tipo de zona"
                      styleClass="group-element"
                      appendTo="body"
                      (click)="$event.stopPropagation()"
                    ></p-dropdown>
                  </p-inputGroup>
                </div>
                <div class="col-12 md:col-6" *ngIf="es_especialista">
                  <p-inputGroup>
                    <p-inputGroupAddon>UGEL</p-inputGroupAddon>
                    <p-dropdown
                      [options]="ugeles"
                      [showClear]="!es_especialista_ugel"
                      formControlName="iUgelId"
                      placeholder="Seleccione una UGEL"
                      styleClass="group-element"
                      appendTo="body"
                      (click)="$event.stopPropagation()"
                    ></p-dropdown>
                  </p-inputGroup>
                </div>
                <div class="col-12 md:col-6" *ngIf="es_especialista">
                  <p-inputGroup>
                    <p-inputGroupAddon>Distrito</p-inputGroupAddon>
                    <p-dropdown
                      [options]="distritos"
                      showClear="true"
                      formControlName="iDsttId"
                      placeholder="Seleccione un distrito"
                      styleClass="group-element"
                      filter="true"
                      appendTo="body"
                      (click)="$event.stopPropagation()"
                    ></p-dropdown>
                  </p-inputGroup>
                </div>
                <div class="col-12">
                  <p-inputGroup>
                    <p-inputGroupAddon>I. E.</p-inputGroupAddon>
                    <p-dropdown
                      [options]="ies"
                      [showClear]="es_especialista"
                      formControlName="iIieeId"
                      placeholder="Seleccione una Institución Educativa"
                      styleClass="group-element"
                      filter="true"
                      appendTo="body"
                      (click)="$event.stopPropagation()"
                    ></p-dropdown>
                  </p-inputGroup>
                </div>
                <div class="col-12 md:col-6">
                  <p-inputGroup>
                    <p-inputGroupAddon>Sección</p-inputGroupAddon>
                    <p-dropdown
                      [options]="secciones"
                      showClear="true"
                      formControlName="iSeccionId"
                      placeholder="Seleccione una sección"
                      styleClass="group-element"
                      filter="true"
                      appendTo="body"
                      (click)="$event.stopPropagation()"
                    ></p-dropdown>
                  </p-inputGroup>
                </div>
                <div class="col-12 md:col-6">
                  <p-inputGroup>
                    <p-inputGroupAddon>Género</p-inputGroupAddon>
                    <p-dropdown
                      [options]="sexos"
                      showClear="true"
                      formControlName="cPersSexo"
                      placeholder="Seleccione un sexo"
                      styleClass="group-element"
                      appendTo="body"
                      (click)="$event.stopPropagation()"
                    ></p-dropdown>
                  </p-inputGroup>
                </div>
                <div class="col-12">
                  <p-button
                    label="Aplicar"
                    severity="success"
                    (click)="filtrarRespuestasFormulario()"
                  />
                </div>
              </div>
            </form>
          </ng-template>
        </p-overlayPanel>
      </div>
      <div class="col-12 md:col">
        <p-inputGroup>
          <p-inputGroupAddon> Buscar </p-inputGroupAddon>
          <input #filtro type="text" pInputText (input)="filtrarRespuestas()" />
        </p-inputGroup>
      </div>
    </div>
  </div>
  <app-table-primeng
    [columnas]="columnasTabla"
    [data]="respuestas_filtradas"
    (accionBtnItem)="accionBnt($event)"
    [actions]="accionesTabla"
    [showCaption]="false"
  />
</p-panel>
