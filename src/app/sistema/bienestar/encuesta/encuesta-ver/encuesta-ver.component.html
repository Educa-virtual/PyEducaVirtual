<p-breadcrumb
    class="max-w-full"
    [model]="breadCrumbItems"
    [home]="breadCrumbHome"
/>

<p-panel>
    <ng-template pTemplate="header">
        <span class="text-2xl text-uppercase">
            <div class="flex flex-column">
                <div class="flex text-xl">RESPONDER ENCUESTA</div>
                <div class="flex text-sm">{{ cEncuNombre }}</div>
            </div>
        </span>
    </ng-template>
    <ng-template pTemplate="icons" class="flex justify-content-center">
        <span>Hasta: {{ dEncuHasta | date: 'dd/MM/yyyy' }}</span>
    </ng-template>
    <div class="grid p-fluid">
        <div class="col-12">
            <p-messages severity="info">
                <ng-template pTemplate>
                    {{ cEncuDescripcion }}
                </ng-template>
            </p-messages>
        </div>
    </div>
    <div
        class="grid p-fluid mt-3"
        *ngFor="let pregunta of preguntas; let i = index"
    >
        @switch (+pregunta.iEncuPregTipoId) {
            <!-- Pregunta cerrada Si/No -->
            @case (1) {
                <div class="col-12">
                    <app-pregunta-cerrada
                        [addonLabel]="pregunta.cEncuPregContenido"
                        [switchControl]="
                            $any(
                                preguntasFormArray
                                    .at(i)
                                    .get('cEncuRptaContenido')
                            )
                        "
                        [infoAdicional]="
                            pregunta.cEncuPregAdicional ? infoAdicional : null
                        "
                    ></app-pregunta-cerrada>
                    <ng-template #infoAdicional>
                        {{ pregunta.cEncuPregAdicional }}
                    </ng-template>
                </div>
            }
            <!-- Pregunta de texto -->
            @case (2) {
                <div class="col-12">
                    <app-pregunta-abierta
                        [addonLabel]="pregunta.cEncuPregContenido"
                        [inputControl]="
                            $any(
                                preguntasFormArray
                                    .at(i)
                                    .get('cEncuRptaContenido')
                            )
                        "
                        [infoAdicional]="
                            pregunta.cEncuPregAdicional ? infoAdicional : null
                        "
                    />
                    <ng-template #infoAdicional>
                        {{ pregunta.cEncuPregAdicional }}
                    </ng-template>
                </div>
            }
            <!-- Pregunta de escalas 1 a 5 -->
            @case (3) {
                <div class="col-12">
                    <app-pregunta-escala
                        [addonLabel]="pregunta.cEncuPregContenido"
                        [ratingControl]="
                            $any(
                                preguntasFormArray
                                    .at(i)
                                    .get('cEncuRptaContenido')
                            )
                        "
                        [infoAdicional]="
                            pregunta.cEncuPregAdicional ? infoAdicional : null
                        "
                    />
                    <ng-template #infoAdicional>
                        {{ pregunta.cEncuPregAdicional }}
                    </ng-template>
                </div>
            }
        }
    </div>

    <div class="flex justify-content-end gap-2">
        <p-button
            label="Salir sin guardar"
            severity="secondary"
            icon="pi pi-arrow-left"
            (onClick)="salir()"
        />
        <p-button
            label="Guardar"
            (onClick)="guardarRespuesta()"
            styleClass="p-button-success"
            icon="pi pi-save"
        />
    </div>
</p-panel>

<p-toast></p-toast>
