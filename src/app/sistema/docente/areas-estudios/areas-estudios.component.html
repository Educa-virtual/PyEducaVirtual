<div class="grid">
  <p-table
    #dv
    class="col-12 hoverTable"
    [value]="data"
    paginator="true"
    [rows]="10"
    [globalFilterFields]="['cCursoNombre']"
  >
    <ng-template pTemplate="header">
      <tr>
        @switch (iPerfilId) {
          @case (DOCENTE) {
            <th style="width: 1rem">#</th>
            <th style="width: 15rem">Nombre del Área Curricular</th>
            <th style="width: 2rem; text-align: center">Total Estudiantes</th>
            <th style="width: 2rem; text-align: center">Nivel de Estudio</th>
            <th style="width: 2rem; text-align: center">Grado</th>
            <th style="width: 2rem; text-align: center">Sección</th>
            <th style="width: 8rem; text-align: center">Acción</th>
            <th style="width: 2rem; text-align: center">Aula Virtual</th>
          }
          @case (ESTUDIANTE) {
            <th style="width: 1rem">#</th>
            <th style="width: 10rem">Nombre del Área Curricular</th>
            <th style="width: 10rem">Nombre del Docente</th>
            <th style="width: 2rem; text-align: center">Grado</th>
            <th style="width: 2rem; text-align: center">Sección</th>
            <th style="width: 2rem; text-align: center">% Asistencia</th>
            <th style="width: 2rem; text-align: center">% Inasistencia</th>
            <th style="width: 2rem; text-align: center">Aula Virtual</th>
          }
        }
      </tr>
    </ng-template>
    <ng-template pTemplate="emptymessage" let-columns>
      <tr>
        @switch (iPerfilId) {
          @case (DOCENTE) {
            <td [attr.colspan]="8">No se encontraron resultados.</td>
          }
          @case (ESTUDIANTE) {
            <td [attr.colspan]="5">No se encontraron resultados.</td>
          }
        }
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-item let-rowIndex="rowIndex">
      <tr>
        @switch (iPerfilId) {
          @case (DOCENTE) {
            <td class="justify-content-center">
              {{ rowIndex + 1 }}
            </td>
            <td class="font-bold">
              {{ item.cCursoNombre }}
            </td>
            <td style="text-align: center">
              {{ item.cantidad }}
            </td>
            <td style="text-align: center">
              {{ item.cNivelTipoNombre }}
            </td>
            <td style="text-align: center">
              {{ item.cGradoAbreviacion }}
            </td>
            <td style="text-align: center">
              {{ item.cSeccionNombre }}
            </td>
            <td style="text-align: center">
              <div class="align-items-center align-content-center">
                <button
                  pTooltip="Gestionar Área Curricular"
                  [rounded]="true"
                  pButton
                  pRipple
                  class="p-1 mx-1 p-button-rounded p-button-primary p-button-text"
                  (click)="this.selectedData = item; menu.toggle($event)"
                >
                  <i class="pi pi-chevron-down"></i>&nbsp;Seleccionar
                </button>
              </div>
            </td>
            <td style="text-align: center">
              <p-button
                severity="success"
                [routerLink]="['./', item.iSilaboId || 0]"
                [queryParams]="{
                  cCursoNombre: item.cCursoNombre,
                  cNivelTipoNombre: item.cNivelTipoNombre,
                  cGradoAbreviacion: item.cGradoAbreviacion,
                  cSeccionNombre: item.cSeccionNombre,
                  cCicloRomanos: item.cCicloRomanos,
                  cNivelNombreCursos: item.cNivelNombreCursos,
                  iCursoId: item.iCursoId,
                  idDocCursoId: item.idDocCursoId,
                  iNivelCicloId: item.iNivelCicloId,
                  iIeCursoId: item.iIeCursoId,
                  iSeccionId: item.iSeccionId,
                  iNivelGradoId: item.iNivelGradoId,
                  cantidad: item.cantidad,
                }"
                label="Acceder"
                icon="pi pi-arrow-right"
                iconPos="right"
              />
            </td>
          }

          @case (ESTUDIANTE) {
            <td class="justify-content-center">
              {{ rowIndex + 1 }}
            </td>
            <td class="font-bold">
              {{ item.cCursoNombre }}
            </td>
            <td class="font-bold" [class]="item.bDocente === '0' ? 'text-center' : ''">
              {{ item.bDocente === '1' ? item.cDocente : '-' }}
            </td>
            <td style="text-align: center">
              {{ item.cGradoAbreviacion }}
            </td>
            <td style="text-align: center">{{ item.cSeccion }}</td>
            <td style="text-align: center">{{ item.pAsistencia }} %</td>
            @if (item.pInasistencia > 33) {
              <td style="text-align: center; color: red">{{ item.pInasistencia }} %</td>
            } @else {
              <td style="text-align: center">{{ item.pInasistencia }} %</td>
            }
            <td style="text-align: center">
              <p-button
                severity="success"
                [routerLink]="['./', item.iSilaboId || 0]"
                [queryParams]="{
                  cCursoNombre: item.cCursoNombre,
                  cNivelTipoNombre: item.cNivelTipoNombre,
                  cGradoAbreviacion: item.cGradoAbreviacion,
                  cSeccionNombre: item.cSeccion,
                  cCicloRomanos: item.cCicloRomanos,
                  cNivelNombreCursos: item.cNivelNombreCursos,
                  iCursoId: item.iCursoId,
                  idDocCursoId: item.idDocCursoId,
                  iNivelCicloId: item.iNivelCicloId,
                  iIeCursoId: item.iIeCursoId,
                  iSeccionId: item.iSeccionId,
                  iNivelGradoId: item.iNivelGradoId,
                  cantidad: item.cantidad,
                }"
                label="Acceder"
                icon="pi pi-arrow-right"
                iconPos="right"
              />
            </td>
          }
        }
      </tr>
    </ng-template>
  </p-table>
</div>

<p-menu [style]="{ minWidth: '25rem' }" #menu [model]="items" [popup]="true" />

<p-dialog [modal]="true" [(visible)]="visibleProgramacion" [style]="{ width: '50rem' }">
  <ng-template pTemplate="header">
    <span class="font-bold text-xl text-white">Programacion Curricular</span>
  </ng-template>
  <div class="grid mt-3">
    <div class="col-12">
      <p-fileUpload
        #fileUpload
        name="archivos[]"
        (onSelect)="seleccionar($event, fileUpload)"
        [auto]="true"
        [multiple]="false"
        [showUploadButton]="false"
        [showCancelButton]="false"
        [customUpload]="true"
        accept=".pdf"
        maxFileSize="1000000"
      >
        <ng-template pTemplate="content">
          <div class="grid">
            <div class="col-12" *ngFor="let ficha of documentos">
              <p-inputGroup>
                <button type="button" pButton class="p-button-default">
                  <i class="pi pi-link"></i>
                </button>
                <input
                  type="text"
                  pInputText
                  [placeholder]="ficha.nombre ? ficha.nombre : 'Programacion Curricular'"
                  disabled
                  class="w-full p-inputtext-sm opacity-100"
                  pInputText
                />
                <button
                  type="button"
                  (click)="descargarArchivo(ficha.ruta)"
                  pButton
                  class="p-button-default"
                >
                  <i class="pi pi-eye"></i>
                </button>
              </p-inputGroup>
            </div>
          </div>
        </ng-template>
      </p-fileUpload>
    </div>
  </div>
</p-dialog>

<!-- <p-dialog [modal]="true" [(visible)]="visible" [style]="{ width: '50rem' }">
  <ng-template pTemplate="header">
    <span class="font-bold text-xl text-white"
      >Importar Silabos - {{ descripcion | lowercase }}</span
    >
  </ng-template>
  <div class="grid mt-3">
    <div class="col-12 md:col-6">
      <p-dropdown
        appendTo="body"
        [options]="opcionCurso"
        [(ngModel)]="seleccionarCurso"
        optionValue="idDocCursoId"
        optionLabel="curso"
        placeholder="Seleccionar silabos del Área Curricular"
      />
    </div>
    <div class="col-12 md:col-6">
      <button
        [disabled]="seleccionarCurso === ''"
        [rounded]="true"
        pButton
        pRipple
        (click)="guardarImportacion()"
      >
        Guardar Importación
      </button>
    </div>
  </div>
</p-dialog> -->

<p-toast />
