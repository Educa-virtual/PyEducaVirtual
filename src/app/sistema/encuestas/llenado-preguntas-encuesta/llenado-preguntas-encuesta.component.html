<p-breadcrumb class="max-w-full" [model]="breadCrumbItems" [home]="breadCrumbHome" />

<p-panel>
  <ng-template pTemplate="header">
    <div class="flex flex-column">
      <div class="flex text-xl">Preguntas de encuesta</div>
      <div class="flex text-sm">{{ encuesta?.cEncuTitulo }}</div>
    </div>
  </ng-template>
  <ng-template pTemplate="icons" class="flex justify-content-center">
    <div class="flex flex-wrap gap-2 justify-content-end">
      <p-button
        size="small"
        severity="secondary"
        pTooltip="Ver encuesta"
        tooltipPosition="top"
        (click)="salir()"
      >
        <i class="pi pi-arrow-left"></i>
        <span class="ml-2 hidden md:inline">Volver a encuesta</span>
      </p-button>
    </div>
  </ng-template>

  <div class="flex justify-content-between flex-wrap m-2">
    <p-button
      icon="pi pi-plus"
      label="Agregar sección"
      severity="primary"
      styleClass="w-full md:inline"
      (click)="mostrarDialogoSeccion = true"
      onclick="onAgregarSeccion($event)"
    />
    <div class="card p-1">
      <span class="font-semibold hidden md:inline">Total de </span>
      <span class="font-semibold">Preguntas: </span>
      <p-badge [value]="totalPreguntas" severity="primary" size="large" />
    </div>
  </div>

  <br />

  <p-accordion styleClass="w-full" [multiple]="true">
    @for (seccion of secciones; track seccion.iSeccionId) {
      <p-accordionTab iconPos="start" [selected]="true">
        <ng-template pTemplate="header">
          <span class="flex align-items-center justify-content-start w-full">
            <span>{{ seccion.cSeccionTitulo }}</span>
            <div
              class="flex gap-1 ml-auto"
              tabindex="0"
              (click)="$event.stopPropagation()"
              (keydown.enter)="$event.stopPropagation()"
            >
              <p-button
                size="small"
                severity="warning"
                pTooltip="Editar sección"
                tooltipPosition="top"
                (onClick)="editarSeccion(seccion)"
              >
                <i class="pi pi-pencil"></i>
                <span class="ml-2 hidden md:inline">Editar</span>
              </p-button>
              <p-button
                size="small"
                severity="danger"
                pTooltip="Eliminar sección"
                tooltipPosition="top"
                (onClick)="eliminarSeccion(seccion)"
              >
                <i class="pi pi-trash"></i>
                <span class="ml-2 hidden md:inline">Eliminar</span>
              </p-button>
            </div>
          </span>
        </ng-template>

        @for (pregunta of seccion.preguntas; track pregunta.iPregId) {
          <p-panel>
            <ng-template pTemplate="header">
              {{ pregunta.cPregContenido }}
            </ng-template>
            <div class="flex">
              <p-button
                severity="success"
                icon="pi pi-pen-to-square"
                label="Editar"
                size="small"
                class="m-2"
                pTooltip="Editar pregunta"
                tooltipPosition="top"
                (onClick)="editarPregunta(pregunta)"
              />
              <p-button
                severity="danger"
                icon="pi pi-trash"
                label="Eliminar"
                size="small"
                class="m-2"
                pTooltip="Eliminar pregunta"
                tooltipPosition="top"
                (onClick)="eliminarPregunta(pregunta)"
              />
            </div>
          </p-panel>
        }

        <br />

        <div class="flex flex-row-reverse">
          <p-button
            icon="pi pi-plus"
            label="Agregar pregunta"
            severity="primary"
            size="small"
            (onClick)="agregarPregunta(seccion)"
          >
          </p-button>
        </div>
      </p-accordionTab>

      <br />
    }
  </p-accordion>

  <app-seccion
    [visible]="mostrarDialogoSeccion"
    (visibleChange)="mostrarDialogoSeccion = $event"
    (AgregarSeccionEncuesta)="onAgregarSeccion($event)"
  >
  </app-seccion>

  <app-pregunta
    [visible]="mostrarDialogoPregunta"
    (visibleChange)="mostrarDialogoPregunta = $event"
  >
  </app-pregunta>
</p-panel>

<p-toast></p-toast>
