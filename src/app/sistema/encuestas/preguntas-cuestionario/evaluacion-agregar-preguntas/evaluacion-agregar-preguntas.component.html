<div class="card">
    <div class="grid">
        <div class="grid col-12 md:col-6 align-content-center font-bold">
            <!-- <b class="ml-1" style="font-size: 18px"
                >Evaluación: {{ data?.cEvaluacionNombre || '-' }} -
                {{ data?.cNivelEvalNombre || '' }}</b
            ><br /> -->
            <div class="m-2">
                <p-button
                    icon="pi pi-eye"
                    label="Vista previa"
                    severity="warning"
                />
            </div>
            <div class="m-2">
                <p-button
                    icon="pi pi-cog"
                    label="Configuración"
                    severity="secondary"
                />
            </div>
            <div class="m-2">
                <p-button
                    icon="pi pi-link"
                    label="Adjuntar"
                    severity="success"
                />
            </div>
        </div>
        <div class="col-12 md:col-3 text-center align-content-center font-bold">
            <span style="font-size: 18px">Total Preguntas:</span>
            <span>
                <p-badge
                    [value]="totalPregunta"
                    severity="primary"
                    styleClass="ml-2"
                    badgeSize="large"
                >
                </p-badge>
            </span>
        </div>
        <div class="col-12 md:col-3 text-right">
            <button
                pButton
                class="p-button-primary gap-2"
                (click)="mostrarModalSecciones()"
            >
                <i class="pi pi-plus"></i>
                <span class="text-md">Agregar sección</span>
            </button>
            <!-- *ngIf="isDisabled" (click)="menuAgregarPreguntas.toggle($event)" -->
            <p-menu
                #menuAgregarPreguntas
                [popup]="true"
                [model]="tiposAgregarPregunta"
                appendTo="body"
                styleClass="w-20rem"
            >
            </p-menu>
        </div>
        @if (!preguntas.length) {
            <div class="col-12">
                <p-divider></p-divider>
                <div class="p-4 rounded">
                    <div class="m-4 text-center border-dashed rounded p-4">
                        <app-no-data
                            [showIcon]="'NO-DATA'"
                            [mensaje]="
                                'No se encontraron preguntas en este formulario.'
                            "
                        ></app-no-data>
                    </div>
                </div>
            </div>
        } @else {
            <div class="col-12">
                <p-accordion styleClass="w-full">
                    @for (list of preguntas; track id; let id = $index) {
                        <p-accordionTab
                            iconPos="end"
                            (click)="nIndexAcordionTab = id"
                            [ngClass]="{ indexTab: nIndexAcordionTab === id }"
                        >
                            <ng-template pTemplate="header">
                                <span
                                    class="flex align-items-center justify-content-start w-full"
                                >
                                    <span class="font-bold whitespace-nowrap">{{
                                        list.title
                                            | removeHTMLCSS
                                            | truncateText: 80
                                    }}</span>
                                    <p-button
                                        *ngIf="isDisabled"
                                        icon="pi pi-trash"
                                        iconPos="left"
                                        severity="danger"
                                        class="ml-auto mr-2"
                                        [rounded]="true"
                                        (onClick)="
                                            $event.stopPropagation();
                                            confirmarEliminarPregunta(list)
                                        "
                                    ></p-button>
                                </span>
                            </ng-template>
                            @for (
                                item of list.pregunta;
                                track idx;
                                let idx = $index
                            ) {
                                <div class="grid">
                                    <div class="col-12">
                                        <label
                                            for="enunciado"
                                            class="mt-1 font-bold"
                                            >Pregunta
                                            <span class="text-red-500 text-xs"
                                                >(*) Obligatorio</span
                                            ></label
                                        >
                                        <editor
                                            [init]="init"
                                            [(ngModel)]="item.cPregunta"
                                        />
                                    </div>

                                    <div class="col-12 mt-1">
                                        <div class="flex font-bold text-center">
                                            <div
                                                class="flex font-bold align-items-center text-primary"
                                            >
                                                Lista de Alternativas
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        @for (
                                            alternativa of item.alternativas;
                                            track ida;
                                            let ida = $index
                                        ) {
                                            <div
                                                class="p-2"
                                                [ngStyle]="{
                                                    'border-left':
                                                        alternativa.bAlternativaCorrecta
                                                            ? '4px solid #22c55e'
                                                            : 'inherit',
                                                    background:
                                                        alternativa.bAlternativaCorrecta
                                                            ? 'rgb(227 253 237)'
                                                            : 'transparent',
                                                }"
                                            >
                                                <p-inputGroup class="mt-1">
                                                    <p-inputGroupAddon>
                                                        {{
                                                            alternativa.cAlternativaLetra
                                                        }}
                                                    </p-inputGroupAddon>
                                                    <input
                                                        type="text"
                                                        pInputText
                                                        placeholder="Ingrese la alternativa"
                                                        [disabled]="!isDisabled"
                                                        [(ngModel)]="
                                                            alternativa.cAlternativaDescripcion
                                                        "
                                                    />

                                                    <div
                                                        class="align-content-center p-2 border-img"
                                                    >
                                                        <p-image
                                                            [src]="
                                                                backend +
                                                                '/' +
                                                                alternativa.cAlternativaImagen
                                                            "
                                                            alt="Image"
                                                            width="25"
                                                            [preview]="true"
                                                            (onImageError)="
                                                                updateUrl(
                                                                    alternativa
                                                                )
                                                            "
                                                        />
                                                    </div>

                                                    <button
                                                        *ngIf="isDisabled"
                                                        type="button"
                                                        pButton
                                                        [text]="true"
                                                        icon="pi pi-trash"
                                                        class="p-button-danger"
                                                        size="small"
                                                        (click)="
                                                            eliminarAlternativa(
                                                                ida,
                                                                item.alternativas
                                                            )
                                                        "
                                                    >
                                                        &nbsp;
                                                    </button>
                                                    <button
                                                        *ngIf="isDisabled"
                                                        pButton
                                                        type="button"
                                                        [text]="true"
                                                        class="p-button-primary btn-file-image"
                                                        size="small"
                                                    >
                                                        <i
                                                            class="pi pi-image"
                                                        ></i
                                                        ><input
                                                            type="file"
                                                            accept="image/*"
                                                            (change)="
                                                                onUploadChange(
                                                                    $event,
                                                                    alternativa
                                                                )
                                                            "
                                                        />
                                                    </button>
                                                    <p-checkbox
                                                        [class]="
                                                            !isDisabled
                                                                ? 'ml-2'
                                                                : ''
                                                        "
                                                        [label]="
                                                            'Respuesta Correcta'
                                                        "
                                                        [inputId]="
                                                            alternativa.iAlternativaId
                                                        "
                                                        [value]="alternativa"
                                                        [(ngModel)]="
                                                            alternativa.bAlternativaCorrecta
                                                        "
                                                        [binary]="true"
                                                        [disabled]="!isDisabled"
                                                        (onChange)="
                                                            cambiarEstadoCheckbox(
                                                                alternativa.iAlternativaId,
                                                                item.alternativas
                                                            )
                                                        "
                                                    />
                                                </p-inputGroup>
                                                @if (
                                                    alternativa.bAlternativaCorrecta
                                                ) {
                                                    <p-inputGroup class="mt-1">
                                                        <p-inputGroupAddon>
                                                            Explicación
                                                        </p-inputGroupAddon>
                                                        <input
                                                            [disabled]="
                                                                !isDisabled
                                                            "
                                                            type="text"
                                                            pInputText
                                                            placeholder="Ingrese la explicación"
                                                            [(ngModel)]="
                                                                alternativa.cAlternativaExplicacion
                                                            "
                                                        />
                                                    </p-inputGroup>
                                                }
                                            </div>
                                        }
                                    </div>
                                    <div class="col-12">
                                        <div class="text-center">
                                            <button
                                                *ngIf="isDisabled"
                                                pButton
                                                pRipple
                                                type="button"
                                                class="p-button-primary pulse"
                                                (click)="
                                                    agregarAlternativa(item)
                                                "
                                            >
                                                <i class="pi pi-plus"></i>&nbsp;
                                                Añadir Alternativa
                                            </button>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <div class="text-center">
                                            <button
                                                *ngIf="isDisabled"
                                                pButton
                                                pRipple
                                                type="button"
                                                class="p-button-success btn-block"
                                                (click)="
                                                    guardarPreguntaConData(
                                                        false,
                                                        list,
                                                        null
                                                    )
                                                "
                                            >
                                                <i class="pi pi-check"></i
                                                >&nbsp; Guardar Pregunta
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            }
                        </p-accordionTab>
                    }
                </p-accordion>
            </div>
        }
    </div>
</div>
<!-- <p-dialog
    [header]="
        'Agregar preguntas de ' +
        data?.cCursoNombre +
        ' - ' +
        data?.cGradoAbreviacion +
        ' - ' +
        data?.cNivelTipoNombre +
        ''
    "
    [modal]="true"
    [(visible)]="showModalBancoPreguntas"
    (onShow)="bancoPreguntasEre.obtenerDatos()"
    (onHide)="bancoPreguntasEre.limpiarDatos()"
    [style]="{ width: '85rem' }"
>
    <app-banco-preguntas-ere
        #bancoPreguntasEre
        (actualizarListaPreguntasEvent)="
            obtenerPreguntasxiEvaluacionIdxiCursoNivelGradId()
        "
        (cerrarDialogEvent)="showModalBancoPreguntas = $event"
        [iEvaluacionId]="iEvaluacionId"
        [iCursosNivelGradId]="iCursoNivelGradId"
    ></app-banco-preguntas-ere>
</p-dialog> -->
<p-dialog
    [header]="'AGREGAR SECCIÓN'"
    [modal]="true"
    [(visible)]="showModalSecciones"
    [style]="{ width: '35rem' }"
    class="scssmodal"
>
    <form [formGroup]="formSeccion" class="flex flex-column gap-3 w-full">
        <div class="col-12">
            <div class="flex justify-content-start my-5">
                <p-floatLabel class="w-full">
                    <input
                        pInputText
                        id="username"
                        formControlName="title"
                        class="w-full"
                    />
                    <label for="username" class="font-bold"
                        >Nombre
                        <span class="text-red-500 text-xs">
                            (*) Obligatorio</span
                        >
                    </label>
                </p-floatLabel>
            </div>
            <div class="mb-3 flex justify-content-start">
                <p-floatLabel class="w-full">
                    <input
                        pInputText
                        id="username"
                        formControlName="descripcionSeccion"
                        class="w-full"
                    />
                    <label for="username" class="font-bold"
                        >Descripción
                        <span class="text-red-500 text-xs">
                            (*) Obligatorio
                        </span>
                    </label>
                </p-floatLabel>
            </div>
            <div class="">
                <p-inputGroup>
                    <p-inputGroupAddon> Agregar después de: </p-inputGroupAddon>
                    <p-dropdown
                        [options]="secciones"
                        formControlName="iSeccionId"
                        optionValue="iSeccionId"
                        optionLabel="title"
                        placeholder="Seleccione una sección"
                        [style]="{ width: '100%' }"
                        [showClear]="true"
                        appendTo="body"
                    ></p-dropdown>
                </p-inputGroup>
            </div>
        </div>
    </form>
    <div class="flex justify-content-end mt-2">
        <button
            pButton
            type="button"
            label="Guardar Sección"
            icon="pi pi-check"
            class="p-button-success"
            (click)="guardarSeccion()"
            [disabled]="formSeccion.invalid"
        ></button>
    </div>
</p-dialog>
<!-- <p-dialog
    [(visible)]="showModalSecciones"
    [style]="{ width: '50%' }"
    class="p-fluid"
    header="Calificar a: "
    [modal]="true"
>
    
    <div class="reply-container">
        <div class="button-container">
            <button
                pButton
                pRipple
                label="Cancelar"
                icon="pi pi-times"
                class="p-button-secondary mx-3"
                type="button"
                size="small"
                
            ></button>
            <button
                pButton
                pRipple
                type="button"
                label="Enviar"
                icon="pi pi-send"
                size="small"
                class="p-button-primary"
                
            ></button>
        </div>
    </div>
</p-dialog> -->

<p-toast></p-toast>
