<p-breadcrumb class="max-w-full" [model]="breadCrumbItems" [home]="breadCrumbHome" />

<p-panel>
  <ng-template pTemplate="header">
    <span class="text-2xl text-uppercase">
      <div class="flex flex-column">
        <div class="flex text-xl">RESUMEN DE ENCUESTA</div>
        <div class="flex text-sm">{{ cEncuNombre }}</div>
      </div>
    </span>
  </ng-template>

  <div style="position: relative; display: block">
    <div class="grid mb-3">
      <div class="col-12">
        <p-button
          #overlayAnchor
          (click)="filtros.toggle($event)"
          icon="pi pi-filter"
          severity="success"
          [label]="'Ver filtros aplicados (' + filtros_aplicados + ')'"
        />
        <p-overlayPanel
          #filtros
          [appendTo]="overlayAnchorRef?.nativeElement"
          [dismissable]="false"
          [showCloseIcon]="true"
          [style]="{ width: '100%', maxWidth: '600px' }"
        >
          <ng-template pTemplate="content">
            <form [formGroup]="formFiltros" class="p-fluid">
              <div class="grid">
                <div class="col-12" [ngClass]="ocultar_area ? 'col-12' : 'md:col-6'">
                  <p-inputGroup>
                    <p-inputGroupAddon>Participantes</p-inputGroupAddon>
                    <p-dropdown
                      [options]="participantes"
                      [showClear]="true"
                      formControlName="iPerfilId"
                      placeholder="Seleccione el tipo de participante"
                      styleClass="group-element"
                      [style]="{ flex: '1', width: '100%' }"
                    ></p-dropdown>
                  </p-inputGroup>
                </div>
                <div class="col-12 md:col-6" [hidden]="ocultar_area">
                  <p-inputGroup>
                    <p-inputGroupAddon>Área</p-inputGroupAddon>
                    <p-dropdown
                      [options]="areas"
                      [showClear]="true"
                      formControlName="iCursoId"
                      placeholder="Seleccione un área"
                      styleClass="group-element"
                      [style]="{ flex: '1', width: '100%' }"
                    ></p-dropdown>
                  </p-inputGroup>
                </div>
                <div
                  class="col-12"
                  [ngClass]="ocultar_grado ? 'col-12' : 'md:col-6'"
                  [hidden]="ocultar_nivel"
                >
                  <p-inputGroup>
                    <p-inputGroupAddon>Nivel</p-inputGroupAddon>
                    <p-dropdown
                      [options]="nivel_tipos"
                      [showClear]="es_especialista"
                      formControlName="iNivelTipoId"
                      placeholder="Seleccione un nivel"
                      styleClass="group-element"
                      [style]="{ flex: '1', width: '100%' }"
                    ></p-dropdown>
                  </p-inputGroup>
                </div>
                <div class="col-12 md:col-6" [hidden]="ocultar_grado">
                  <p-inputGroup>
                    <p-inputGroupAddon>Grado</p-inputGroupAddon>
                    <p-dropdown
                      [options]="nivel_grados"
                      showClear="true"
                      formControlName="iNivelGradoId"
                      placeholder="Seleccione un grado"
                      styleClass="group-element"
                      filter="true"
                      [style]="{ flex: '1', width: '100%' }"
                    ></p-dropdown>
                  </p-inputGroup>
                </div>
                <div class="col-12 md:col-6" *ngIf="es_especialista" [hidden]="ocultar_gestion">
                  <p-inputGroup>
                    <p-inputGroupAddon>Gestión</p-inputGroupAddon>
                    <p-dropdown
                      [options]="tipo_sectores"
                      showClear="true"
                      formControlName="iTipoSectorId"
                      placeholder="Seleccione un tipo de gestión"
                      styleClass="group-element"
                      [style]="{ flex: '1', width: '100%' }"
                    ></p-dropdown>
                  </p-inputGroup>
                </div>
                <div class="col-12 md:col-6" *ngIf="es_especialista" [hidden]="ocultar_zona">
                  <p-inputGroup>
                    <p-inputGroupAddon>Zona</p-inputGroupAddon>
                    <p-dropdown
                      [options]="zonas"
                      showClear="true"
                      formControlName="iZonaId"
                      placeholder="Seleccione un tipo de zona"
                      styleClass="group-element"
                      [style]="{ flex: '1', width: '100%' }"
                    ></p-dropdown>
                  </p-inputGroup>
                </div>
                <div class="col-12 md:col-6" *ngIf="es_especialista" [hidden]="ocultar_ugel">
                  <p-inputGroup>
                    <p-inputGroupAddon>UGEL</p-inputGroupAddon>
                    <p-dropdown
                      [options]="ugeles"
                      [showClear]="!es_especialista_ugel"
                      formControlName="iUgelId"
                      placeholder="Seleccione una UGEL"
                      styleClass="group-element"
                      [style]="{ flex: '1', width: '100%' }"
                    ></p-dropdown>
                  </p-inputGroup>
                </div>
                <div class="col-12 md:col-6" *ngIf="es_especialista" [hidden]="ocultar_distrito">
                  <p-inputGroup>
                    <p-inputGroupAddon>Distrito</p-inputGroupAddon>
                    <p-dropdown
                      [options]="distritos"
                      showClear="true"
                      formControlName="iDsttId"
                      placeholder="Seleccione un distrito"
                      styleClass="group-element"
                      filter="true"
                      [style]="{ flex: '1', width: '100%' }"
                    ></p-dropdown>
                  </p-inputGroup>
                </div>
                <div class="col-12" [hidden]="ocultar_ie">
                  <p-inputGroup>
                    <p-inputGroupAddon>I. E.</p-inputGroupAddon>
                    <p-dropdown
                      [options]="ies"
                      [showClear]="es_especialista"
                      formControlName="iIieeId"
                      placeholder="Seleccione una Institución Educativa"
                      styleClass="group-element"
                      filter="true"
                      [style]="{ flex: '1', width: '100%' }"
                    ></p-dropdown>
                  </p-inputGroup>
                </div>
                <div class="col-12 md:col-6" [hidden]="ocultar_seccion">
                  <p-inputGroup>
                    <p-inputGroupAddon>Sección</p-inputGroupAddon>
                    <p-dropdown
                      [options]="secciones"
                      showClear="true"
                      formControlName="iSeccionId"
                      placeholder="Seleccione una sección"
                      styleClass="group-element"
                      filter="true"
                      [style]="{ flex: '1', width: '100%' }"
                    ></p-dropdown>
                  </p-inputGroup>
                </div>
                <div class="col-12" [ngClass]="ocultar_seccion ? 'col-12' : 'md:col-6'">
                  <p-inputGroup>
                    <p-inputGroupAddon>Género</p-inputGroupAddon>
                    <p-dropdown
                      [options]="sexos"
                      showClear="true"
                      formControlName="cPersSexo"
                      placeholder="Seleccione un sexo"
                      styleClass="group-element"
                      [style]="{ flex: '1', width: '100%' }"
                    ></p-dropdown>
                  </p-inputGroup>
                </div>
                <div class="col-12">
                  <div class="flex flex-wrap gap-2">
                    <p-button
                      label="Aplicar"
                      severity="success"
                      (click)="verResumen()"
                      class="flex"
                    />
                    <p-button
                      label="Descargar gráficos"
                      icon="pi pi-download"
                      class="p-button-warning"
                      class="flex"
                      (onClick)="descargarReporte()"
                    />
                  </div>
                </div>
              </div>
            </form>
          </ng-template>
        </p-overlayPanel>
      </div>
    </div>
  </div>

  <form>
    <div class="grid">
      <div class="col-12" *ngFor="let pregunta of preguntas; let i = index">
        @if (pregunta.iSeccionId !== preguntas[i - 1]?.iSeccionId) {
          <p-inputGroup class="vertical-group">
            <p-inputGroupAddon class="font-bold">
              {{ pregunta.iSeccionOrden + '. ' + pregunta.cSeccionTitulo }}
            </p-inputGroupAddon>
          </p-inputGroup>
          <br />
        }
        <p-fieldset
          [legend]="
            pregunta.iSeccionOrden + '.' + pregunta.iPregOrden + '. ' + pregunta.cPregContenido
          "
          [toggleable]="true"
          [collapsed]="false"
          [style]="{ width: '100%' }"
        >
          <ng-container *ngIf="pregunta.resumen">
            <div class="grid text-panel" [formGroup]="getFormResumenPregunta(i)">
              <div class="col-12" *ngIf="+pregunta.iTipoPregId === TIPO_PREG_TEXTO">
                <p-inputGroup>
                  <p-inputGroupAddon>Tipo de reporte</p-inputGroupAddon>
                  <p-dropdown
                    [options]="tipos_reportes"
                    formControlName="iTipoReporte"
                    [filter]="true"
                    [showClear]="false"
                    appendTo="body"
                    placeholder="Seleccione"
                    [style]="{ flex: '1', width: '100%' }"
                    styleClass="group-element"
                  />
                </p-inputGroup>
              </div>
              <div class="col-12" *ngIf="+pregunta.iTipoPregId !== TIPO_PREG_TEXTO">
                <app-multi-chart [data_chart]="pregunta.resumen" />
              </div>
              <div class="col-12" *ngIf="+pregunta.iTipoPregId === TIPO_PREG_TEXTO">
                <p-message
                  *ngIf="!pregunta.resumen_grafico"
                  severity="info"
                  text="No hay datos para mostrar"
                />
                <p-chart
                  *ngIf="
                    pregunta.resumen_grafico &&
                    getFormResumenPregunta(i).get('iTipoReporte')?.value === TIPO_REPORTE_LISTA
                  "
                  type="bar"
                  [data]="pregunta.resumen_grafico"
                  [options]="options_bar"
                  [plugins]="plugin_bar"
                  style="width: 100%"
                />
                <app-wordcloud-chart
                  *ngIf="
                    pregunta.resumen_wordcloud &&
                    getFormResumenPregunta(i).get('iTipoReporte')?.value === TIPO_REPORTE_INDIVIDUAL
                  "
                  [wordCloudData]="pregunta.resumen_wordcloud"
                  [WordCloudOptions]="options_wordcloud"
                />
              </div>
            </div>
          </ng-container>
        </p-fieldset>
      </div>
    </div>
  </form>
</p-panel>

<p-toast></p-toast>
