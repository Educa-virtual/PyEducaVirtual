<p-breadcrumb class="max-w-full" [model]="breadCrumbItems" [home]="breadCrumbHome" />
<app-container-page [title]="'Asistencia del estudiante'" [actions]="[]">
  <div class="attendance-calendar">
    <div class="controls flex justify-content-center align-items-center gap-2">
      <p-button icon="pi pi-chevron-left" [loading]="loading" (onClick)="prevMonth()" />
      <p-dropdown
        [options]="months"
        optionLabel="label"
        optionValue="value"
        [(ngModel)]="selectedMonth"
        (onChange)="onMonthChange($event.value)"
        placeholder="Mes"
      ></p-dropdown>
      <p-button icon="pi pi-chevron-right" [loading]="loading" (onClick)="nextMonth()" />
      <!--<div class="spacer"></div>-->
      <button
        pButton
        label="Refrescar"
        icon="pi pi-refresh"
        (click)="load()"
        [disabled]="loading"
      ></button>
    </div>

    <div class="calendar-grid" *ngIf="!loading">
      <div class="weekdays">
        <div *ngFor="let wd of weekDays" class="weekday">{{ wd }}</div>
      </div>

      <div class="weeks">
        <div class="week" *ngFor="let week of weeks">
          <div
            class="daycell"
            *ngFor="let cell of week"
            tabindex="0"
            role="button"
            [ngClass]="statusClass(cell.cTipoAsiLetra)"
            (click)="mostrarDetalles(cell)"
            (keydown.enter)="mostrarDetalles(cell)"
            style="cursor: pointer"
          >
            <div class="day-number" *ngIf="cell.numeroDia">{{ cell.numeroDia }}</div>
            <div class="mark" *ngIf="cell.cTipoAsiLetra">{{ cell.cTipoAsiLetra }}</div>
          </div>
        </div>
      </div>
    </div>

    <!--<div *ngIf="loading" class="loading">Cargando...</div>-->

    <div
      class="leyenda-summary flex block flex-wrap column-gap-3 row-gap-3 p-2"
      *ngIf="leyendaModal && leyendaModal.length"
    >
      <div *ngFor="let lista of leyendaModal" class="flex mr-1">
        <p-inputGroup class="grupo">
          <button type="button" size="small" pButton [ngClass]="lista.bgColor">
            {{ lista.simbolo }}
          </button>
          <div [ngClass]="lista.divColor">
            {{ lista.significado }}
          </div>
        </p-inputGroup>
      </div>
    </div>
  </div>
</app-container-page>

<p-dialog
  [header]="
    'Detalle de asistencia - ' +
    (selectedCell?.fecha ? (selectedCell.fecha | date: 'dd/MM/y') : '-')
  "
  [(visible)]="showDialog"
  [modal]="true"
  [style]="{ width: '50rem' }"
>
  <div *ngIf="selectedCell">
    <br />
    <div class="mb-5">
      <strong>Estado:</strong>
      <span [ngClass]="statusClass(selectedCell.cTipoAsiLetra)">{{
        selectedCell.cTipoAsiNombre || '-'
      }}</span>
    </div>

    <p-table [value]="selectedCell.cursos">
      <ng-template pTemplate="header">
        <tr>
          <th style="width: 25%">Curso</th>
          <th>Docente</th>
          <th style="width: 25%">Estado</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-curso>
        <tr>
          <td>{{ curso.cCursoNombre }}</td>
          <td>{{ curso.cPersPaterno }} {{ curso.cPersMaterno }} {{ curso.cPersNombre }}</td>
          <td [ngClass]="statusClass(curso.cTipoAsiLetra)">{{ curso.cTipoAsiNombre }}</td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</p-dialog>
<p-toast />
