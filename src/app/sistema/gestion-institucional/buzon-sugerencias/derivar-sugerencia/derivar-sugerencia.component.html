<br />

<p-fieldset legend="Registrar derivación">
    <form [formGroup]="form" class="mt-3">
        <div class="grid p-fluid mt-3">
            <div class="field col-12 md:col-6">
                <span class="p-float-label">
                    <p-multiSelect
                        [options]="destinos"
                        formControlName="iDestinoId"
                        [showClear]="true"
                        [filter]="true"
                        [showToggleAll]="false"
                        [appendTo]="'body'"
                        (onChange)="marcarDestinos($event)"
                    />
                    <label for="iDestinoId">Destino</label>
                </span>
            </div>
            <div class="field col-12 md:col-6">
                <span class="p-float-label">
                    <input pInputText type="text" formControlName="cProveido" />
                    <label for="cProveido">Proveído *</label>
                </span>
            </div>
            @if (disable_form) {
                <div class="field col-12">
                    <a
                        href="#"
                        class="p-button-link p-button-text mr-2"
                        target="_blank"
                    >
                        <p-chip>
                            <span
                                class="bg-primary border-circle w-2rem h-2rem flex align-items-center justify-content-center"
                            >
                                <i class="pi pi-file"></i>
                            </span>
                            <span class="ml-2"> Mi_sugerencia_2023.pdf </span>
                        </p-chip>
                    </a>
                    <a
                        href="#"
                        class="p-button-link p-button-text mx-2"
                        target="_blank"
                    >
                        <p-chip>
                            <span
                                class="bg-primary border-circle w-2rem h-2rem flex align-items-center justify-content-center"
                            >
                                <i class="pi pi-file"></i>
                            </span>
                            <span class="ml-2">
                                Foto_adjunta_20230101.jpg
                            </span>
                        </p-chip>
                    </a>
                </div>
            } @else {
                <div class="field col-12">
                    <p-fileUpload
                        name="demo[]"
                        showUploadButton="false"
                        [multiple]="true"
                        chooseLabel="Seleccione hasta 3 archivos (max. 10 MB)"
                        cancelLabel="Quitar archivos"
                        fileLimit="3"
                        maxFileSize="10240"
                    >
                        <ng-template pTemplate="content">
                            <ul *ngIf="uploadedFiles.length">
                                <li *ngFor="let file of uploadedFiles">
                                    {{ file.name }} - {{ file.size }} bytes
                                </li>
                            </ul>
                        </ng-template>
                    </p-fileUpload>
                </div>
            }
        </div>
        <div class="flex justify-content-end" *ngIf="!disable_form">
            <p-button
                label="Añadir"
                (onClick)="addDerivacion()"
                icon="pi pi-fw pi-plus"
                severity="success"
                [hidden]="derivacion_registrada"
            />
        </div>
    </form>
</p-fieldset>

<br />

<app-table-primeng
    [columnas]="columns"
    [showCaption]="false"
    [data]="derivaciones"
    [showPaginator]="false"
    [actions]="actions"
    (accionBtnItem)="accionBtnItemTable($event)"
/>

<br />

<div class="flex justify-content-end" *ngIf="!disable_form">
    <p-button
        label="Guardar"
        (onClick)="guardarDerivacion()"
        severity="success"
        icon="pi pi-fw pi-save"
        [disabled]="derivaciones.length === 0"
        [hidden]="derivacion_registrada"
    />
    <p-button
        label="Actualizar"
        (onClick)="actualizarDerivacion()"
        severity="success"
        icon="pi pi-fw pi-refresh"
        [disabled]="derivaciones.length === 0"
        [hidden]="!derivacion_registrada"
    />
</div>
