<p-panel>
    <ng-template pTemplate="header">
        <div class="flex flex-column gap-2">
            <h3 class="m-0 text-uppercase text-primary">
                Buzon de sugerencias
            </h3>
        </div>
    </ng-template>
    <ng-template pTemplate="icons" class="flex flex-column flex-1">
        <div class="flex flex-wrap gap-2 justify-content-end">
            <button
                size="small"
                [rounded]="true"
                pButton
                pTooltip="Registrar sugerencia"
                tooltipPosition="top"
                (click)="agregarSugerencia()"
                class="p-button-primary"
                *ngIf="es_estudiante"
            >
                <i class="pi pi-plus"></i>
                <span class="ml-2 hidden sm:block">Registar sugerencia</span>
            </button>
        </div>
    </ng-template>

    <app-table-primeng
        [columnas]="columns"
        [showCaption]="true"
        [data]="sugerencias"
        (accionBtnItem)="accionBtnItemTable($event)"
        [showPaginator]="true"
        sortMode="single"
        sortField="_cPersNomape"
        [sortOrder]="1"
        [(selectedRowData)]="selectedItems"
        [actions]="actions"
        [showAdvancedFilter]="true"
        [showColumnFilter]="false"
    >
    </app-table-primeng>
</p-panel>

<p-dialog
    [header]="dialog_header"
    [(visible)]="visible"
    [style]="{ width: '56rem' }"
    [modal]="true"
    [contentStyle]="{ overflow: 'auto' }"
    (onHide)="resetearInputs()"
>
    <ng-content>
        <form [formGroup]="form">
            <div class="grid p-fluid mt-3">
                <div class="field col-12 md:col-6">
                    <span class="p-float-label">
                        <p-multiSelect
                            [options]="destinos"
                            formControlName="iDestinoId"
                            optionLabel="nombre"
                            optionValue="id"
                            [showClear]="true"
                            [filter]="true"
                            [appendTo]="'body'"
                        />
                        <label for="iDestinoId">Destino</label>
                    </span>
                </div>
                <div class="field col-12 md:col-6">
                    <span class="p-float-label">
                        <p-dropdown
                            [options]="prioridades"
                            formControlName="iPrioridadId"
                            optionLabel="nombre"
                            [checkmark]="true"
                            optionValue="id"
                            [showClear]="true"
                            [filter]="true"
                            [appendTo]="'body'"
                        />
                        <label for="iPrioridadId">Prioridad *</label>
                    </span>
                </div>
                <div class="field col-12">
                    <span class="p-float-label">
                        <input
                            pInputText
                            type="text"
                            formControlName="cAsunto"
                        />
                        <label for="cAsunto">Asunto *</label>
                    </span>
                </div>
                <div class="field col-12">
                    <p-editor
                        formControlName="cSugerencia"
                        [style]="{ height: '150px' }"
                        placeholder="Explique su sugerencia *"
                        [readonly]="disable_form"
                    />
                </div>
                @if (disable_form) {
                    <div class="field col-12">
                        <a
                            href="#"
                            class="p-button-link p-button-text mr-2"
                            target="_blank"
                        >
                            <p-chip>
                                <span
                                    class="bg-primary border-circle w-2rem h-2rem flex align-items-center justify-content-center"
                                >
                                    <i class="pi pi-file"></i>
                                </span>
                                <span class="ml-2">
                                    Mi_sugerencia_2023.pdf
                                </span>
                            </p-chip>
                        </a>
                        <a
                            href="#"
                            class="p-button-link p-button-text mx-2"
                            target="_blank"
                        >
                            <p-chip>
                                <span
                                    class="bg-primary border-circle w-2rem h-2rem flex align-items-center justify-content-center"
                                >
                                    <i class="pi pi-file"></i>
                                </span>
                                <span class="ml-2">
                                    Foto_adjunta_20230101.jpg
                                </span>
                            </p-chip>
                        </a>
                    </div>
                } @else {
                    <div class="field col-12">
                        <p-fileUpload
                            name="demo[]"
                            showUploadButton="false"
                            [multiple]="true"
                            chooseLabel="Seleccione hasta 3 archivos (max. 10 MB)"
                            cancelLabel="Quitar archivos"
                            fileLimit="3"
                            maxFileSize="10240"
                        >
                            <ng-template pTemplate="content">
                                <ul *ngIf="uploadedFiles.length">
                                    <li *ngFor="let file of uploadedFiles">
                                        {{ file.name }} - {{ file.size }} bytes
                                    </li>
                                </ul>
                            </ng-template>
                        </p-fileUpload>
                    </div>
                }
            </div>
            <div class="flex justify-content-end" *ngIf="!disable_form">
                <p-button
                    label="Guardar"
                    (onClick)="guardarSugerencia()"
                    styleClass="p-button-primary"
                    [disabled]="form.invalid"
                    [hidden]="sugerencia_registrada"
                />
                <p-button
                    label="Actualizar"
                    (onClick)="actualizarSugerencia()"
                    styleClass="p-button-primary"
                    [disabled]="form.invalid"
                    [hidden]="!sugerencia_registrada"
                />
            </div>
        </form>
    </ng-content>
</p-dialog>
<p-toast></p-toast>
