<p-tabView>
  <p-toast />
  <p-tabPanel header="Historial de apoderados">
    <form [formGroup]="frmApoderado">
      <div class="grid p-fluid mt-3">
        <div class="field col-5">
          <span class="p-float-label">
            <p-dropdown
              [options]="tipos_documentos"
              formControlName="iTipoIdentId"
              optionLabel="nombre"
              optionValue="id"
              [filter]="true"
              [showClear]="true"
              [appendTo]="'body'"
            />
            <label for="iTipoIdentId">Tipo de documento *</label>
          </span>
        </div>
        <div class="field col-4">
          <span class="p-float-label">
            <p-inputMask
              formControlName="cPersDocumento"
              aria-describedby="cPersDocumento-help"
              [maxlength]="longitud_documento"
              [mask]="formato_documento"
              autoClear="false"
              slotChar=""
            />
            <label for="cPersDocumento">Documento *</label>
          </span>
        </div>
        <div class="field col-3">
          <p-button label="Validar" styleClass="p-button-primary" (onClick)="validarDocumento()" />
        </div>

        <div class="field col-12">
          <p-message [severity]="sever" [text]="mensaje" styleClass="p-mr-2"></p-message>
        </div>
      </div>

      <div *ngIf="bDocumentoValido" class="grid p-fluid mt-3">
        <div class="field col-3">
          <span class="p-float-label">
            <p-dropdown
              [options]="tipos_familiar"
              formControlName="iTipoFamiliarId"
              optionLabel="cTipoFamiliarDescripcion"
              optionValue="iTipoFamiliarId"
              [filter]="true"
              [showClear]="true"
              [appendTo]="'body'"
            />
            <label for="iTipoFamiliarId">Tipo familiar *</label>
          </span>
        </div>
        <div class="field col-6">
          <span class="p-float-label">
            <input
              pInputText
              id="cObservacion"
              formControlName="cObservacion"
              aria-describedby="cObservacion-help"
            />
            <label for="cObservacion">Observaciones </label>
          </span>
        </div>
        <div class="field col-3">
          <p-button
            *ngIf="!bEditar"
            label="Asignar apoderado"
            styleClass="p-button-success"
            (click)="asignarApoderado()"
            [disabled]="frmApoderado.invalid"
          />
          <p-button
            *ngIf="bEditar"
            label="Actualizar apoderado"
            styleClass="p-button-warning"
            (click)="accionBtnItemTable({ accion: 'editar' })"
            [disabled]="frmApoderado.invalid"
          />
        </div>
      </div>
    </form>
    <p-panel>
      <!-- <p-fieldset legend="Historial de apoderados" [toggleable]="true" [collapsed]="false"> -->
      <div>
        @if (apoderados.length > 0) {
          <app-table-primeng
            [columnas]="columns"
            [data]="apoderados"
            [showCaption]="false"
            (accionBtnItem)="accionBtnItemTable($event)"
            [showPaginator]="true"
            [(selectedRowData)]="selectedItems"
            [actions]="actions"
            [showAdvancedFilter]="true"
          >
          </app-table-primeng>
        } @else {
          <p-message
            severity="info"
            text="No se encontraron apoderados registrados."
            styleClass="p-mr-2"
          >
          </p-message>
        }
      </div>
    </p-panel>
  </p-tabPanel>
  <p-tabPanel header="Registrar apoderado">
    <form [formGroup]="form">
      <div class="grid p-fluid mt-3">
        <div class="field col-12 md:col-6">
          <span class="p-float-label">
            <p-dropdown
              [options]="tipos_documentos"
              formControlName="iTipoIdentId"
              optionLabel="nombre"
              optionValue="id"
              [filter]="true"
              [showClear]="true"
              [appendTo]="'body'"
            />
            <label for="iTipoIdentId">Tipo de documento *</label>
          </span>
        </div>
        <div class="field col-6 md:col-4">
          <span class="p-float-label">
            <p-inputMask
              formControlName="cPersDocumento"
              aria-describedby="cPersDocumento-help"
              [maxlength]="longitud_documento"
              [mask]="formato_documento"
              autoClear="false"
              slotChar=""
            />
            <label for="cPersDocumento">Documento *</label>
          </span>
        </div>
        <div class="field col-6 md:col-2">
          <p-button label="Validar" styleClass="p-button-primary" (onClick)="validarPersona()" />
        </div>

        <div class="field col-12 md:col-4">
          <span class="p-float-label">
            <input
              pInputText
              id="cPersPaterno"
              formControlName="cPersPaterno"
              aria-describedby="cPersPaterno-help"
            />
            <label for="cPersPaterno">Primer Apellido *</label>
          </span>
        </div>
        <div class="field col-12 md:col-4">
          <span class="p-float-label">
            <input
              pInputText
              id="cPersMaterno"
              formControlName="cPersMaterno"
              aria-describedby="cPersMaterno-help"
            />
            <label for="cPersMaterno">Segundo Apellido</label>
          </span>
        </div>

        <div class="field col-12 md:col-4">
          <span class="p-float-label">
            <input
              pInputText
              id="cPersNombre"
              formControlName="cPersNombre"
              aria-describedby="cPersNombre-help"
            />
            <label for="cPersNombre">Nombres *</label>
          </span>
        </div>
        <div class="field col-12 md:col-6">
          <span class="p-float-label">
            <p-dropdown
              [options]="estados_civiles"
              formControlName="iTipoEstCivId"
              optionLabel="nombre"
              [checkmark]="true"
              optionValue="id"
              [filter]="true"
              [showClear]="true"
              [appendTo]="'body'"
            />
            <label for="iTipoEstCivId">Estado Civil</label>
          </span>
        </div>
        <div class="field col-12 md:col-6">
          <span class="p-float-label">
            <p-dropdown
              [options]="sexos"
              formControlName="cPersSexo"
              optionLabel="nombre"
              [checkmark]="true"
              optionValue="id"
              [filter]="true"
              [showClear]="true"
              [appendTo]="'body'"
            />
            <label for="cPersSexo">Sexo *</label>
          </span>
        </div>
      </div>

      <div class="grid p-fluid mt-3">
        <div class="field col-12 md:col-4">
          <span class="p-float-label">
            <p-dropdown
              [options]="nacionalidades"
              formControlName="iNacionId"
              optionLabel="nombre"
              [checkmark]="true"
              optionValue="id"
              [filter]="true"
              [showClear]="true"
              [appendTo]="'body'"
            />
            <label for="iNacionId">Nacionalidad</label>
          </span>
        </div>
        <div class="field col-12 md:col-4">
          <span class="p-float-label">
            <p-calendar
              formControlName="dPersNacimiento"
              [iconDisplay]="'input'"
              [showIcon]="true"
              inputId="dPersNacimiento"
              [appendTo]="'body'"
            />
            <label for="dPersNacimiento">Fecha de nacimiento *</label>
          </span>
        </div>
      </div>

      <div class="grid p-fluid mt-3">
        <div class="field col-12 md:col-4">
          <span class="p-float-label">
            <p-dropdown
              [options]="departamentos"
              formControlName="iDptoId"
              optionLabel="nombre"
              optionValue="id"
              [filter]="true"
              [showClear]="true"
              [appendTo]="'body'"
            />
            <label for="iDptoId">Departamento</label>
          </span>
        </div>
        <div class="field col-12 md:col-4">
          <span class="p-float-label">
            <p-dropdown
              [options]="provincias"
              formControlName="iPrvnId"
              optionLabel="nombre"
              optionValue="id"
              [filter]="true"
              [showClear]="true"
              [appendTo]="'body'"
            />
            <label for="iPrvnId">Provincia</label>
          </span>
        </div>
        <div class="field col-12 md:col-4">
          <span class="p-float-label">
            <p-dropdown
              [options]="distritos"
              formControlName="iDsttId"
              optionLabel="nombre"
              optionValue="id"
              [filter]="true"
              [showClear]="true"
              [appendTo]="'body'"
            />
            <label for="iDsttId">Distrito</label>
          </span>
        </div>

        <div class="field col-12">
          <span class="p-float-label">
            <input
              pInputText
              formControlName="cPersDomicilio"
              aria-describedby="cPersDomicilio-help"
            />
            <label for="cPersDomicilio">Direcci√≥n</label>
          </span>
        </div>
      </div>
    </form>
  </p-tabPanel>
</p-tabView>
